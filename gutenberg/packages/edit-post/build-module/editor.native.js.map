{"version":3,"sources":["@wordpress/edit-post/src/editor.native.js"],"names":["memize","size","map","without","subscribeSetFocusOnTitle","I18nManager","Component","EditorProvider","parse","serialize","withDispatch","withSelect","compose","SlotFillProvider","SiteCapabilitiesContext","Layout","Editor","props","arguments","initialHtmlModeEnabled","mode","switchEditorMode","getEditorSettings","maxSize","setTitleRef","bind","settings","hasFixedToolbar","focusMode","hiddenBlockTypes","blockTypes","isRTL","defaultAllowedBlockTypes","allowedBlockTypes","subscriptionParentSetFocusOnTitle","postTitleRef","focus","remove","titleRef","initialEdits","post","postType","editorSettings","normalizedPost","id","title","raw","initialTitle","content","initialHtml","type","status","meta","capabilities","select","isFeatureActive","getEditorMode","getPreference","__experimentalGetPreviewDeviceType","getBlockTypes","dispatch"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport memize from 'memize';\nimport { size, map, without } from 'lodash';\nimport { subscribeSetFocusOnTitle } from 'react-native-gutenberg-bridge';\nimport { I18nManager } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { EditorProvider } from '@wordpress/editor';\nimport { parse, serialize } from '@wordpress/blocks';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport {\n\tSlotFillProvider,\n\tSiteCapabilitiesContext,\n} from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\nimport Layout from './components/layout';\n\nclass Editor extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\tif ( props.initialHtmlModeEnabled && props.mode === 'visual' ) {\n\t\t\t// enable html mode if the initial mode the parent wants it but we're not already in it\n\t\t\tthis.props.switchEditorMode( 'text' );\n\t\t}\n\n\t\tthis.getEditorSettings = memize( this.getEditorSettings, {\n\t\t\tmaxSize: 1,\n\t\t} );\n\n\t\tthis.setTitleRef = this.setTitleRef.bind( this );\n\t}\n\n\tgetEditorSettings(\n\t\tsettings,\n\t\thasFixedToolbar,\n\t\tfocusMode,\n\t\thiddenBlockTypes,\n\t\tblockTypes\n\t) {\n\t\tsettings = {\n\t\t\t...settings,\n\t\t\tisRTL: I18nManager.isRTL,\n\t\t\thasFixedToolbar,\n\t\t\tfocusMode,\n\t\t};\n\n\t\t// Omit hidden block types if exists and non-empty.\n\t\tif ( size( hiddenBlockTypes ) > 0 ) {\n\t\t\t// Defer to passed setting for `allowedBlockTypes` if provided as\n\t\t\t// anything other than `true` (where `true` is equivalent to allow\n\t\t\t// all block types).\n\t\t\tconst defaultAllowedBlockTypes =\n\t\t\t\ttrue === settings.allowedBlockTypes\n\t\t\t\t\t? map( blockTypes, 'name' )\n\t\t\t\t\t: settings.allowedBlockTypes || [];\n\n\t\t\tsettings.allowedBlockTypes = without(\n\t\t\t\tdefaultAllowedBlockTypes,\n\t\t\t\t...hiddenBlockTypes\n\t\t\t);\n\t\t}\n\n\t\treturn settings;\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.subscriptionParentSetFocusOnTitle = subscribeSetFocusOnTitle(\n\t\t\t() => {\n\t\t\t\tif ( this.postTitleRef ) {\n\t\t\t\t\tthis.postTitleRef.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this.subscriptionParentSetFocusOnTitle ) {\n\t\t\tthis.subscriptionParentSetFocusOnTitle.remove();\n\t\t}\n\t}\n\n\tsetTitleRef( titleRef ) {\n\t\tthis.postTitleRef = titleRef;\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tsettings,\n\t\t\thasFixedToolbar,\n\t\t\tfocusMode,\n\t\t\tinitialEdits,\n\t\t\thiddenBlockTypes,\n\t\t\tblockTypes,\n\t\t\tpost,\n\t\t\tpostType,\n\t\t\t...props\n\t\t} = this.props;\n\n\t\tconst editorSettings = this.getEditorSettings(\n\t\t\tsettings,\n\t\t\thasFixedToolbar,\n\t\t\tfocusMode,\n\t\t\thiddenBlockTypes,\n\t\t\tblockTypes\n\t\t);\n\n\t\tconst normalizedPost = post || {\n\t\t\tid: 1,\n\t\t\ttitle: {\n\t\t\t\traw: props.initialTitle,\n\t\t\t},\n\t\t\tcontent: {\n\t\t\t\t// make sure the post content is in sync with gutenberg store\n\t\t\t\t// to avoid marking the post as modified when simply loaded\n\t\t\t\t// For now, let's assume: serialize( parse( html ) ) !== html\n\t\t\t\traw: serialize( parse( props.initialHtml || '' ) ),\n\t\t\t},\n\t\t\ttype: postType,\n\t\t\tstatus: 'draft',\n\t\t\tmeta: [],\n\t\t};\n\n\t\treturn (\n\t\t\t<SlotFillProvider>\n\t\t\t\t<SiteCapabilitiesContext.Provider\n\t\t\t\t\tvalue={ this.props.capabilities }\n\t\t\t\t>\n\t\t\t\t\t<EditorProvider\n\t\t\t\t\t\tsettings={ editorSettings }\n\t\t\t\t\t\tpost={ normalizedPost }\n\t\t\t\t\t\tinitialEdits={ initialEdits }\n\t\t\t\t\t\tuseSubRegistry={ false }\n\t\t\t\t\t\t{ ...props }\n\t\t\t\t\t>\n\t\t\t\t\t\t<Layout setTitleRef={ this.setTitleRef } />\n\t\t\t\t\t</EditorProvider>\n\t\t\t\t</SiteCapabilitiesContext.Provider>\n\t\t\t</SlotFillProvider>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst {\n\t\t\tisFeatureActive,\n\t\t\tgetEditorMode,\n\t\t\tgetPreference,\n\t\t\t__experimentalGetPreviewDeviceType,\n\t\t} = select( 'core/edit-post' );\n\t\tconst { getBlockTypes } = select( 'core/blocks' );\n\n\t\treturn {\n\t\t\thasFixedToolbar:\n\t\t\t\tisFeatureActive( 'fixedToolbar' ) ||\n\t\t\t\t__experimentalGetPreviewDeviceType() !== 'Desktop',\n\t\t\tfocusMode: isFeatureActive( 'focusMode' ),\n\t\t\tmode: getEditorMode(),\n\t\t\thiddenBlockTypes: getPreference( 'hiddenBlockTypes' ),\n\t\t\tblockTypes: getBlockTypes(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { switchEditorMode } = dispatch( 'core/edit-post' );\n\n\t\treturn {\n\t\t\tswitchEditorMode,\n\t\t};\n\t} ),\n] )( Editor );\n"]}