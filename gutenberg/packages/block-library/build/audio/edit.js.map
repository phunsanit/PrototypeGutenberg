{"version":3,"sources":["@wordpress/block-library/src/audio/edit.js"],"names":["ALLOWED_MEDIA_TYPES","AudioEdit","arguments","toggleAttribute","bind","onSelectURL","onUploadError","props","attributes","mediaUpload","noticeOperations","setAttributes","id","src","file","filesList","onFileChange","mediaId","url","onError","e","undefined","createErrorNotice","allowedTypes","attribute","newValue","newSrc","embedBlock","onReplace","message","removeAllNotices","checked","autoplay","caption","loop","preload","isSelected","noticeUI","onSelectAudio","media","icon","getAutoplayHelp","value","label","RichText","isEmpty","Component","select","getSettings","withNotices"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { getBlobByURL, isBlobURL } from '@wordpress/blob';\nimport { compose } from '@wordpress/compose';\nimport {\n\tDisabled,\n\tPanelBody,\n\tSelectControl,\n\tToggleControl,\n\twithNotices,\n} from '@wordpress/components';\nimport {\n\tBlockControls,\n\tBlockIcon,\n\tInspectorControls,\n\tMediaPlaceholder,\n\tMediaReplaceFlow,\n\tRichText,\n\t__experimentalBlock as Block,\n} from '@wordpress/block-editor';\nimport { Component } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { withSelect } from '@wordpress/data';\nimport { audio as icon } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport { createUpgradedEmbedBlock } from '../embed/util';\n\nconst ALLOWED_MEDIA_TYPES = [ 'audio' ];\n\nclass AudioEdit extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.toggleAttribute = this.toggleAttribute.bind( this );\n\t\tthis.onSelectURL = this.onSelectURL.bind( this );\n\t\tthis.onUploadError = this.onUploadError.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst {\n\t\t\tattributes,\n\t\t\tmediaUpload,\n\t\t\tnoticeOperations,\n\t\t\tsetAttributes,\n\t\t} = this.props;\n\t\tconst { id, src = '' } = attributes;\n\n\t\tif ( ! id && isBlobURL( src ) ) {\n\t\t\tconst file = getBlobByURL( src );\n\n\t\t\tif ( file ) {\n\t\t\t\tmediaUpload( {\n\t\t\t\t\tfilesList: [ file ],\n\t\t\t\t\tonFileChange: ( [ { id: mediaId, url } ] ) => {\n\t\t\t\t\t\tsetAttributes( { id: mediaId, src: url } );\n\t\t\t\t\t},\n\t\t\t\t\tonError: ( e ) => {\n\t\t\t\t\t\tsetAttributes( { src: undefined, id: undefined } );\n\t\t\t\t\t\tnoticeOperations.createErrorNotice( e );\n\t\t\t\t\t},\n\t\t\t\t\tallowedTypes: ALLOWED_MEDIA_TYPES,\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleAttribute( attribute ) {\n\t\treturn ( newValue ) => {\n\t\t\tthis.props.setAttributes( { [ attribute ]: newValue } );\n\t\t};\n\t}\n\n\tonSelectURL( newSrc ) {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\tconst { src } = attributes;\n\n\t\t// Set the block's src from the edit component's state, and switch off\n\t\t// the editing UI.\n\t\tif ( newSrc !== src ) {\n\t\t\t// Check if there's an embed block that handles this URL.\n\t\t\tconst embedBlock = createUpgradedEmbedBlock( {\n\t\t\t\tattributes: { url: newSrc },\n\t\t\t} );\n\t\t\tif ( undefined !== embedBlock ) {\n\t\t\t\tthis.props.onReplace( embedBlock );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetAttributes( { src: newSrc, id: undefined } );\n\t\t}\n\t}\n\n\tonUploadError( message ) {\n\t\tconst { noticeOperations } = this.props;\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\n\tgetAutoplayHelp( checked ) {\n\t\treturn checked\n\t\t\t? __(\n\t\t\t\t\t'Note: Autoplaying audio may cause usability issues for some visitors.'\n\t\t\t  )\n\t\t\t: null;\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tid,\n\t\t\tautoplay,\n\t\t\tcaption,\n\t\t\tloop,\n\t\t\tpreload,\n\t\t\tsrc,\n\t\t} = this.props.attributes;\n\t\tconst { setAttributes, isSelected, noticeUI } = this.props;\n\t\tconst onSelectAudio = ( media ) => {\n\t\t\tif ( ! media || ! media.url ) {\n\t\t\t\t// in this case there was an error and we should continue in the editing state\n\t\t\t\t// previous attributes should be removed because they may be temporary blob urls\n\t\t\t\tsetAttributes( { src: undefined, id: undefined } );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// sets the block's attribute and updates the edit component from the\n\t\t\t// selected media, then switches off the editing UI\n\t\t\tsetAttributes( { src: media.url, id: media.id } );\n\t\t};\n\t\tif ( ! src ) {\n\t\t\treturn (\n\t\t\t\t<Block.div>\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\ticon={ <BlockIcon icon={ icon } /> }\n\t\t\t\t\t\tonSelect={ onSelectAudio }\n\t\t\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\t\t\taccept=\"audio/*\"\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\tvalue={ this.props.attributes }\n\t\t\t\t\t\tnotices={ noticeUI }\n\t\t\t\t\t\tonError={ this.onUploadError }\n\t\t\t\t\t/>\n\t\t\t\t</Block.div>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<MediaReplaceFlow\n\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\tmediaURL={ src }\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\taccept=\"audio/*\"\n\t\t\t\t\t\tonSelect={ onSelectAudio }\n\t\t\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\t\t\tonError={ this.onUploadError }\n\t\t\t\t\t/>\n\t\t\t\t</BlockControls>\n\t\t\t\t<InspectorControls>\n\t\t\t\t\t<PanelBody title={ __( 'Audio settings' ) }>\n\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\tlabel={ __( 'Autoplay' ) }\n\t\t\t\t\t\t\tonChange={ this.toggleAttribute( 'autoplay' ) }\n\t\t\t\t\t\t\tchecked={ autoplay }\n\t\t\t\t\t\t\thelp={ this.getAutoplayHelp }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\tlabel={ __( 'Loop' ) }\n\t\t\t\t\t\t\tonChange={ this.toggleAttribute( 'loop' ) }\n\t\t\t\t\t\t\tchecked={ loop }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\tlabel={ __( 'Preload' ) }\n\t\t\t\t\t\t\tvalue={ preload || '' }\n\t\t\t\t\t\t\t// `undefined` is required for the preload attribute to be unset.\n\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tpreload: value || undefined,\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\toptions={ [\n\t\t\t\t\t\t\t\t{ value: '', label: __( 'Browser default' ) },\n\t\t\t\t\t\t\t\t{ value: 'auto', label: __( 'Auto' ) },\n\t\t\t\t\t\t\t\t{ value: 'metadata', label: __( 'Metadata' ) },\n\t\t\t\t\t\t\t\t{ value: 'none', label: __( 'None' ) },\n\t\t\t\t\t\t\t] }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t</InspectorControls>\n\t\t\t\t<Block.figure>\n\t\t\t\t\t{ /*\n\t\t\t\t\t\tDisable the audio tag so the user clicking on it won't play the\n\t\t\t\t\t\tfile or change the position slider when the controls are enabled.\n\t\t\t\t\t*/ }\n\t\t\t\t\t<Disabled>\n\t\t\t\t\t\t<audio controls=\"controls\" src={ src } />\n\t\t\t\t\t</Disabled>\n\t\t\t\t\t{ ( ! RichText.isEmpty( caption ) || isSelected ) && (\n\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\t\tplaceholder={ __( 'Write caption…' ) }\n\t\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\tsetAttributes( { caption: value } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</Block.figure>\n\t\t\t</>\n\t\t);\n\t}\n}\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\tconst { mediaUpload } = getSettings();\n\t\treturn { mediaUpload };\n\t} ),\n\twithNotices,\n] )( AudioEdit );\n"]}