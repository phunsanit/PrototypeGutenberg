{"version":3,"sources":["@wordpress/block-library/src/image/transforms.js"],"names":["stripFirstImage","attributes","shortcode","document","implementation","createHTMLDocument","body","innerHTML","content","nodeToRemove","querySelector","parentNode","removeChild","trim","getFirstAnchorAttributeFormHTML","html","attributeName","firstElementChild","nodeName","getAttribute","undefined","imageSchema","img","classes","schema","phrasingContentSchema","figure","require","children","a","figcaption","transforms","from","type","isMatch","node","transform","className","alignMatches","exec","align","idMatches","id","Number","anchorElement","linkDestination","href","rel","linkClass","outerHTML","files","length","indexOf","file","url","tag","source","attribute","selector","alt","caption","named","parseInt","replace"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { createBlobURL } from '@wordpress/blob';\nimport { createBlock, getBlockAttributes } from '@wordpress/blocks';\n\nexport function stripFirstImage( attributes, { shortcode } ) {\n\tconst { body } = document.implementation.createHTMLDocument( '' );\n\n\tbody.innerHTML = shortcode.content;\n\n\tlet nodeToRemove = body.querySelector( 'img' );\n\n\t// if an image has parents, find the topmost node to remove\n\twhile (\n\t\tnodeToRemove &&\n\t\tnodeToRemove.parentNode &&\n\t\tnodeToRemove.parentNode !== body\n\t) {\n\t\tnodeToRemove = nodeToRemove.parentNode;\n\t}\n\n\tif ( nodeToRemove ) {\n\t\tnodeToRemove.parentNode.removeChild( nodeToRemove );\n\t}\n\n\treturn body.innerHTML.trim();\n}\n\nfunction getFirstAnchorAttributeFormHTML( html, attributeName ) {\n\tconst { body } = document.implementation.createHTMLDocument( '' );\n\n\tbody.innerHTML = html;\n\n\tconst { firstElementChild } = body;\n\n\tif ( firstElementChild && firstElementChild.nodeName === 'A' ) {\n\t\treturn firstElementChild.getAttribute( attributeName ) || undefined;\n\t}\n}\n\nconst imageSchema = {\n\timg: {\n\t\tattributes: [ 'src', 'alt', 'title' ],\n\t\tclasses: [\n\t\t\t'alignleft',\n\t\t\t'aligncenter',\n\t\t\t'alignright',\n\t\t\t'alignnone',\n\t\t\t/^wp-image-\\d+$/,\n\t\t],\n\t},\n};\n\nconst schema = ( { phrasingContentSchema } ) => ( {\n\tfigure: {\n\t\trequire: [ 'img' ],\n\t\tchildren: {\n\t\t\t...imageSchema,\n\t\t\ta: {\n\t\t\t\tattributes: [ 'href', 'rel', 'target' ],\n\t\t\t\tchildren: imageSchema,\n\t\t\t},\n\t\t\tfigcaption: {\n\t\t\t\tchildren: phrasingContentSchema,\n\t\t\t},\n\t\t},\n\t},\n} );\n\nconst transforms = {\n\tfrom: [\n\t\t{\n\t\t\ttype: 'raw',\n\t\t\tisMatch: ( node ) =>\n\t\t\t\tnode.nodeName === 'FIGURE' && !! node.querySelector( 'img' ),\n\t\t\tschema,\n\t\t\ttransform: ( node ) => {\n\t\t\t\t// Search both figure and image classes. Alignment could be\n\t\t\t\t// set on either. ID is set on the image.\n\t\t\t\tconst className =\n\t\t\t\t\tnode.className +\n\t\t\t\t\t' ' +\n\t\t\t\t\tnode.querySelector( 'img' ).className;\n\t\t\t\tconst alignMatches = /(?:^|\\s)align(left|center|right)(?:$|\\s)/.exec(\n\t\t\t\t\tclassName\n\t\t\t\t);\n\t\t\t\tconst align = alignMatches ? alignMatches[ 1 ] : undefined;\n\t\t\t\tconst idMatches = /(?:^|\\s)wp-image-(\\d+)(?:$|\\s)/.exec(\n\t\t\t\t\tclassName\n\t\t\t\t);\n\t\t\t\tconst id = idMatches ? Number( idMatches[ 1 ] ) : undefined;\n\t\t\t\tconst anchorElement = node.querySelector( 'a' );\n\t\t\t\tconst linkDestination =\n\t\t\t\t\tanchorElement && anchorElement.href ? 'custom' : undefined;\n\t\t\t\tconst href =\n\t\t\t\t\tanchorElement && anchorElement.href\n\t\t\t\t\t\t? anchorElement.href\n\t\t\t\t\t\t: undefined;\n\t\t\t\tconst rel =\n\t\t\t\t\tanchorElement && anchorElement.rel\n\t\t\t\t\t\t? anchorElement.rel\n\t\t\t\t\t\t: undefined;\n\t\t\t\tconst linkClass =\n\t\t\t\t\tanchorElement && anchorElement.className\n\t\t\t\t\t\t? anchorElement.className\n\t\t\t\t\t\t: undefined;\n\t\t\t\tconst attributes = getBlockAttributes(\n\t\t\t\t\t'core/image',\n\t\t\t\t\tnode.outerHTML,\n\t\t\t\t\t{\n\t\t\t\t\t\talign,\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tlinkDestination,\n\t\t\t\t\t\thref,\n\t\t\t\t\t\trel,\n\t\t\t\t\t\tlinkClass,\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn createBlock( 'core/image', attributes );\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttype: 'files',\n\t\t\tisMatch( files ) {\n\t\t\t\treturn (\n\t\t\t\t\tfiles.length === 1 &&\n\t\t\t\t\tfiles[ 0 ].type.indexOf( 'image/' ) === 0\n\t\t\t\t);\n\t\t\t},\n\t\t\ttransform( files ) {\n\t\t\t\tconst file = files[ 0 ];\n\t\t\t\t// We don't need to upload the media directly here\n\t\t\t\t// It's already done as part of the `componentDidMount`\n\t\t\t\t// int the image block\n\t\t\t\treturn createBlock( 'core/image', {\n\t\t\t\t\turl: createBlobURL( file ),\n\t\t\t\t} );\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttype: 'shortcode',\n\t\t\ttag: 'caption',\n\t\t\tattributes: {\n\t\t\t\turl: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tsource: 'attribute',\n\t\t\t\t\tattribute: 'src',\n\t\t\t\t\tselector: 'img',\n\t\t\t\t},\n\t\t\t\talt: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tsource: 'attribute',\n\t\t\t\t\tattribute: 'alt',\n\t\t\t\t\tselector: 'img',\n\t\t\t\t},\n\t\t\t\tcaption: {\n\t\t\t\t\tshortcode: stripFirstImage,\n\t\t\t\t},\n\t\t\t\thref: {\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML(\n\t\t\t\t\t\t\tshortcode.content,\n\t\t\t\t\t\t\t'href'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\trel: {\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML(\n\t\t\t\t\t\t\tshortcode.content,\n\t\t\t\t\t\t\t'rel'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tlinkClass: {\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML(\n\t\t\t\t\t\t\tshortcode.content,\n\t\t\t\t\t\t\t'class'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tid: {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tshortcode: ( { named: { id } } ) => {\n\t\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn parseInt( id.replace( 'attachment_', '' ), 10 );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\talign: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tshortcode: ( { named: { align = 'alignnone' } } ) => {\n\t\t\t\t\t\treturn align.replace( 'align', '' );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t],\n};\n\nexport default transforms;\n"]}