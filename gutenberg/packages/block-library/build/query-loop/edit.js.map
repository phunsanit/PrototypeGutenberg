{"version":3,"sources":["@wordpress/block-library/src/query-loop/edit.js"],"names":["TEMPLATE","QueryLoopEdit","clientId","context","query","perPage","offset","categoryIds","queryContext","page","activeBlockContext","setActiveBlockContext","select","categories","per_page","posts","getEntityRecords","blocks","getBlocks","blockContexts","map","post","postType","type","postId","id","blockContext"],"mappings":";;;;;;;;;AAGA;;;;AACA;;AACA;;AASA;;AAdA;;;;AAWA;;;AAKA,IAAMA,QAAQ,GAAG,CAAE,CAAE,iBAAF,CAAF,EAAyB,CAAE,mBAAF,CAAzB,CAAjB;;AACe,SAASC,aAAT,OAMX;AAAA,MALHC,QAKG,QALHA,QAKG;AAAA,0BAJHC,OAIG;AAAA,wCAHFC,KAGE;AAAA,MAHOC,OAGP,sBAHOA,OAGP;AAAA,MAHgBC,MAGhB,sBAHgBA,MAGhB;AAAA,MAHwBC,WAGxB,sBAHwBA,WAGxB;AAAA,MAFFC,YAEE,gBAFFA,YAEE;;AAAA,cACkB,iCAAqBA,YADvC;AAAA;AAAA,MACOC,IADP,YACOA,IADP;;AAAA,kBAEmD,wBAFnD;AAAA;AAAA,MAEKC,kBAFL;AAAA,MAEyBC,qBAFzB;;AAAA,mBAIuB,qBACzB,UAAEC,MAAF,EAAc;AACb,QAAMR,KAAK,GAAG;AACbE,MAAAA,MAAM,EAAED,OAAO,GAAGA,OAAO,IAAKI,IAAI,GAAG,CAAZ,CAAP,GAAyBH,MAA5B,GAAqC,CADvC;AAEbO,MAAAA,UAAU,EAAEN;AAFC,KAAd;;AAIA,QAAKF,OAAL,EAAe;AACdD,MAAAA,KAAK,CAACU,QAAN,GAAiBT,OAAjB;AACA;;AACD,WAAO;AACNU,MAAAA,KAAK,EAAEH,MAAM,CAAE,MAAF,CAAN,CAAiBI,gBAAjB,CACN,UADM,EAEN,MAFM,EAGNZ,KAHM,CADD;AAMNa,MAAAA,MAAM,EAAEL,MAAM,CAAE,mBAAF,CAAN,CAA8BM,SAA9B,CAAyChB,QAAzC;AANF,KAAP;AAQA,GAjBwB,EAkBzB,CAAEG,OAAF,EAAWI,IAAX,EAAiBH,MAAjB,EAAyBC,WAAzB,EAAsCL,QAAtC,CAlByB,CAJvB;AAAA,MAIKa,KAJL,cAIKA,KAJL;AAAA,MAIYE,MAJZ,cAIYA,MAJZ;;AAyBH,MAAME,aAAa,GAAG,sBACrB;AAAA,WACCJ,KADD,aACCA,KADD,uBACCA,KAAK,CAAEK,GAAP,CAAY,UAAEC,IAAF;AAAA,aAAc;AACzBC,QAAAA,QAAQ,EAAED,IAAI,CAACE,IADU;AAEzBC,QAAAA,MAAM,EAAEH,IAAI,CAACI;AAFY,OAAd;AAAA,KAAZ,CADD;AAAA,GADqB,EAMrB,CAAEV,KAAF,CANqB,CAAtB;AAQA,SAAOI,aAAa,GACjBA,aAAa,CAACC,GAAd,CAAmB,UAAEM,YAAF;AAAA,WACnB,4BAAC,iCAAD;AACC,MAAA,GAAG,EAAGA,YAAY,CAACF,MADpB;AAEC,MAAA,KAAK,EAAGE;AAFT,OAIGA,YAAY,MACZhB,kBAAkB,IAAIS,aAAa,CAAE,CAAF,CADvB,CAAZ,GAED,4BAAC,wBAAD;AAAa,MAAA,QAAQ,EAAGnB;AAAxB,MAFC,GAID,4BAAC,yBAAD;AACC,MAAA,MAAM,EAAGiB,MADV;AAEC,MAAA,kBAAkB,MAFnB;AAGC,MAAA,qBAAqB,EAAG;AAAA,eACvBN,qBAAqB,CAAEe,YAAF,CADE;AAAA;AAHzB,MARF,CADmB;AAAA,GAAnB,CADiB,GAoBjB,IApBH;AAqBA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useState, useMemo } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport {\n\tBlockContextProvider,\n\tInnerBlocks,\n\tBlockPreview,\n} from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { useQueryContext } from '../query';\n\nconst TEMPLATE = [ [ 'core/post-title' ], [ 'core/post-content' ] ];\nexport default function QueryLoopEdit( {\n\tclientId,\n\tcontext: {\n\t\tquery: { perPage, offset, categoryIds },\n\t\tqueryContext,\n\t},\n} ) {\n\tconst [ { page } ] = useQueryContext() || queryContext;\n\tconst [ activeBlockContext, setActiveBlockContext ] = useState();\n\n\tconst { posts, blocks } = useSelect(\n\t\t( select ) => {\n\t\t\tconst query = {\n\t\t\t\toffset: perPage ? perPage * ( page - 1 ) + offset : 0,\n\t\t\t\tcategories: categoryIds,\n\t\t\t};\n\t\t\tif ( perPage ) {\n\t\t\t\tquery.per_page = perPage;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tposts: select( 'core' ).getEntityRecords(\n\t\t\t\t\t'postType',\n\t\t\t\t\t'post',\n\t\t\t\t\tquery\n\t\t\t\t),\n\t\t\t\tblocks: select( 'core/block-editor' ).getBlocks( clientId ),\n\t\t\t};\n\t\t},\n\t\t[ perPage, page, offset, categoryIds, clientId ]\n\t);\n\n\tconst blockContexts = useMemo(\n\t\t() =>\n\t\t\tposts?.map( ( post ) => ( {\n\t\t\t\tpostType: post.type,\n\t\t\t\tpostId: post.id,\n\t\t\t} ) ),\n\t\t[ posts ]\n\t);\n\treturn blockContexts\n\t\t? blockContexts.map( ( blockContext ) => (\n\t\t\t\t<BlockContextProvider\n\t\t\t\t\tkey={ blockContext.postId }\n\t\t\t\t\tvalue={ blockContext }\n\t\t\t\t>\n\t\t\t\t\t{ blockContext ===\n\t\t\t\t\t( activeBlockContext || blockContexts[ 0 ] ) ? (\n\t\t\t\t\t\t<InnerBlocks template={ TEMPLATE } />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<BlockPreview\n\t\t\t\t\t\t\tblocks={ blocks }\n\t\t\t\t\t\t\t__experimentalLive\n\t\t\t\t\t\t\t__experimentalOnClick={ () =>\n\t\t\t\t\t\t\t\tsetActiveBlockContext( blockContext )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</BlockContextProvider>\n\t\t  ) )\n\t\t: null;\n}\n"]}