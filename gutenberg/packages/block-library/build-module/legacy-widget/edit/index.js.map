{"version":3,"sources":["@wordpress/block-library/src/legacy-widget/edit/index.js"],"names":["get","Component","Button","PanelBody","ToolbarGroup","__","withSelect","BlockControls","InspectorControls","ServerSideRender","update","LegacyWidgetEditHandler","LegacyWidgetPlaceholder","LegacyWidgetEdit","arguments","state","hasEditForm","isPreview","switchToEdit","bind","switchToPreview","changeWidget","props","attributes","availableLegacyWidgets","hasPermissionsToManageWidgets","isSelected","setAttributes","id","widgetClass","widgetObject","newWidget","isReferenceWidget","instance","undefined","inspectorControls","name","description","renderWidgetPreview","isHidden","idBase","number","newInstance","newHasEditForm","setState","select","editorSettings","getSettings"],"mappings":";;;;;;;;;;;;AAAA;;;AAGA,SAASA,GAAT,QAAoB,QAApB;AAEA;;;;AAGA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,MAAT,EAAiBC,SAAjB,EAA4BC,YAA5B,QAAgD,uBAAhD;AACA,SAASC,EAAT,QAAmB,iBAAnB;AACA,SAASC,UAAT,QAA2B,iBAA3B;AACA,SAASC,aAAT,EAAwBC,iBAAxB,QAAiD,yBAAjD;AACA,OAAOC,gBAAP,MAA6B,+BAA7B;AACA,SAASC,MAAT,QAAuB,kBAAvB;AAEA;;;;AAGA,OAAOC,uBAAP,MAAoC,WAApC;AACA,OAAOC,uBAAP,MAAoC,eAApC;;IAEMC,gB;;;;;AACL,8BAAc;AAAA;;AAAA;;AACb,+BAAUC,SAAV;AACA,UAAKC,KAAL,GAAa;AACZC,MAAAA,WAAW,EAAE,IADD;AAEZC,MAAAA,SAAS,EAAE;AAFC,KAAb;AAIA,UAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBC,IAAlB,+BAApB;AACA,UAAKC,eAAL,GAAuB,MAAKA,eAAL,CAAqBD,IAArB,+BAAvB;AACA,UAAKE,YAAL,GAAoB,MAAKA,YAAL,CAAkBF,IAAlB,+BAApB;AARa;AASb;;;;6BAEQ;AAAA;;AAAA,wBAOJ,KAAKG,KAPD;AAAA,UAEPC,UAFO,eAEPA,UAFO;AAAA,UAGPC,sBAHO,eAGPA,sBAHO;AAAA,UAIPC,6BAJO,eAIPA,6BAJO;AAAA,UAKPC,UALO,eAKPA,UALO;AAAA,UAMPC,aANO,eAMPA,aANO;AAAA,wBAQ2B,KAAKZ,KARhC;AAAA,UAQAE,SARA,eAQAA,SARA;AAAA,UAQWD,WARX,eAQWA,WARX;AAAA,UASAY,EATA,GASoBL,UATpB,CASAK,EATA;AAAA,UASIC,WATJ,GASoBN,UATpB,CASIM,WATJ;AAUR,UAAMC,YAAY,GACfF,EAAE,IAAIJ,sBAAsB,CAAEI,EAAF,CAA9B,IACEC,WAAW,IAAIL,sBAAsB,CAAEK,WAAF,CAFxC;;AAGA,UAAK,CAAED,EAAF,IAAQ,CAAEC,WAAf,EAA6B;AAC5B,eACC,cAAC,uBAAD;AACC,UAAA,sBAAsB,EAAGL,sBAD1B;AAEC,UAAA,6BAA6B,EAC5BC,6BAHF;AAKC,UAAA,cAAc,EAAG,wBAAEM,SAAF,EAAiB;AAAA,gBACzBC,iBADyB,GACHR,sBAAsB,CACnDO,SADmD,CADnB,CACzBC,iBADyB;AAIjCL,YAAAA,aAAa,CAAE;AACdM,cAAAA,QAAQ,EAAE,EADI;AAEdL,cAAAA,EAAE,EAAEI,iBAAiB,GAAGD,SAAH,GAAeG,SAFtB;AAGdL,cAAAA,WAAW,EAAEG,iBAAiB,GAC3BE,SAD2B,GAE3BH;AALW,aAAF,CAAb;AAOA;AAhBF,UADD;AAoBA;;AAED,UAAMI,iBAAiB,GAAGL,YAAY,GACrC,cAAC,iBAAD,QACC,cAAC,SAAD;AAAW,QAAA,KAAK,EAAGA,YAAY,CAACM;AAAhC,SACGN,YAAY,CAACO,WADhB,CADD,CADqC,GAMlC,IANJ;;AAOA,UAAK,CAAEZ,6BAAP,EAAuC;AACtC,eACC,8BACGU,iBADH,EAEG,KAAKG,mBAAL,EAFH,CADD;AAMA;;AAED,aACC,8BACC,cAAC,aAAD,QACC,cAAC,YAAD,QACGR,YAAY,IAAI,CAAEA,YAAY,CAACS,QAA/B,IACD,cAAC,MAAD;AACC,QAAA,OAAO,EAAG,KAAKlB,YADhB;AAEC,QAAA,KAAK,EAAGhB,EAAE,CAAE,eAAF,CAFX;AAGC,QAAA,IAAI,EAAGK;AAHR,QAFF,EAQGM,WAAW,IACZ,8BACC,cAAC,MAAD;AACC,QAAA,SAAS,EAAC,uBADX;AAEC,QAAA,SAAS,EAAG,CAAEC,SAFf;AAGC,QAAA,OAAO,EAAG,KAAKC;AAHhB,SAKC,4BAAQb,EAAE,CAAE,MAAF,CAAV,CALD,CADD,EAQC,cAAC,MAAD;AACC,QAAA,SAAS,EAAC,uBADX;AAEC,QAAA,SAAS,EAAGY,SAFb;AAGC,QAAA,OAAO,EAAG,KAAKG;AAHhB,SAKC,4BAAQf,EAAE,CAAE,SAAF,CAAV,CALD,CARD,CATF,CADD,CADD,EA8BG8B,iBA9BH,EA+BGnB,WAAW,IACZ,cAAC,uBAAD;AACC,QAAA,UAAU,EAAGU,UADd;AAEC,QAAA,SAAS,EAAG,CAAET,SAFf;AAGC,QAAA,EAAE,EAAGW,EAHN;AAIC,QAAA,MAAM,EAAGL,UAAU,CAACiB,MAAX,IAAqBjB,UAAU,CAACK,EAJ1C;AAKC,QAAA,MAAM,EAAGL,UAAU,CAACkB,MALrB;AAMC,QAAA,UAAU,EAAGzC,GAAG,CAAE8B,YAAF,EAAgB,CAAE,MAAF,CAAhB,CANjB;AAOC,QAAA,WAAW,EAAGP,UAAU,CAACM,WAP1B;AAQC,QAAA,QAAQ,EAAGN,UAAU,CAACU,QARvB;AASC,QAAA,gBAAgB,EAAG,0BAAES,WAAF,EAAeC,cAAf,EAAmC;AACrD,cAAKD,WAAL,EAAmB;AAClB,YAAA,MAAI,CAACpB,KAAL,CAAWK,aAAX,CAA0B;AACzBM,cAAAA,QAAQ,EAAES;AADe,aAA1B;AAGA;;AACD,cAAKC,cAAc,KAAK,MAAI,CAAC3B,WAA7B,EAA2C;AAC1C,YAAA,MAAI,CAAC4B,QAAL,CAAe;AACd5B,cAAAA,WAAW,EAAE2B;AADC,aAAf;AAGA;AACD;AApBF,QAhCF,EAuDG,CAAE1B,SAAS,IAAI,CAAED,WAAjB,KAAkC,KAAKsB,mBAAL,EAvDrC,CADD;AA2DA;;;mCAEc;AACd,WAAKpB,YAAL;AACA,WAAKI,KAAL,CAAWK,aAAX,CAA0B;AACzBM,QAAAA,QAAQ,EAAE,EADe;AAEzBL,QAAAA,EAAE,EAAEM,SAFqB;AAGzBL,QAAAA,WAAW,EAAEK;AAHY,OAA1B;AAKA,WAAKU,QAAL,CAAe;AACd5B,QAAAA,WAAW,EAAE;AADC,OAAf;AAGA;;;mCAEc;AACd,WAAK4B,QAAL,CAAe;AAAE3B,QAAAA,SAAS,EAAE;AAAb,OAAf;AACA;;;sCAEiB;AACjB,WAAK2B,QAAL,CAAe;AAAE3B,QAAAA,SAAS,EAAE;AAAb,OAAf;AACA;;;0CAEqB;AAAA,UACbM,UADa,GACE,KAAKD,KADP,CACbC,UADa;AAErB,aACC,cAAC,gBAAD;AACC,QAAA,SAAS,EAAC,iCADX;AAEC,QAAA,KAAK,EAAC,oBAFP;AAGC,QAAA,UAAU,EAAGA;AAHd,QADD;AAOA;;;;EA1J6BtB,S;;AA6J/B,eAAeK,UAAU,CAAE,UAAEuC,MAAF,EAAc;AACxC,MAAMC,cAAc,GAAGD,MAAM,CAAE,mBAAF,CAAN,CAA8BE,WAA9B,EAAvB;AADwC,MAGvCvB,sBAHuC,GAKpCsB,cALoC,CAGvCtB,sBAHuC;AAAA,MAIvCC,6BAJuC,GAKpCqB,cALoC,CAIvCrB,6BAJuC;AAMxC,SAAO;AACNA,IAAAA,6BAA6B,EAA7BA,6BADM;AAEND,IAAAA,sBAAsB,EAAtBA;AAFM,GAAP;AAIA,CAVwB,CAAV,CAUVX,gBAVU,CAAf","sourcesContent":["/**\n * External dependencies\n */\nimport { get } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { Button, PanelBody, ToolbarGroup } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { withSelect } from '@wordpress/data';\nimport { BlockControls, InspectorControls } from '@wordpress/block-editor';\nimport ServerSideRender from '@wordpress/server-side-render';\nimport { update } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport LegacyWidgetEditHandler from './handler';\nimport LegacyWidgetPlaceholder from './placeholder';\n\nclass LegacyWidgetEdit extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\thasEditForm: true,\n\t\t\tisPreview: false,\n\t\t};\n\t\tthis.switchToEdit = this.switchToEdit.bind( this );\n\t\tthis.switchToPreview = this.switchToPreview.bind( this );\n\t\tthis.changeWidget = this.changeWidget.bind( this );\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tattributes,\n\t\t\tavailableLegacyWidgets,\n\t\t\thasPermissionsToManageWidgets,\n\t\t\tisSelected,\n\t\t\tsetAttributes,\n\t\t} = this.props;\n\t\tconst { isPreview, hasEditForm } = this.state;\n\t\tconst { id, widgetClass } = attributes;\n\t\tconst widgetObject =\n\t\t\t( id && availableLegacyWidgets[ id ] ) ||\n\t\t\t( widgetClass && availableLegacyWidgets[ widgetClass ] );\n\t\tif ( ! id && ! widgetClass ) {\n\t\t\treturn (\n\t\t\t\t<LegacyWidgetPlaceholder\n\t\t\t\t\tavailableLegacyWidgets={ availableLegacyWidgets }\n\t\t\t\t\thasPermissionsToManageWidgets={\n\t\t\t\t\t\thasPermissionsToManageWidgets\n\t\t\t\t\t}\n\t\t\t\t\tonChangeWidget={ ( newWidget ) => {\n\t\t\t\t\t\tconst { isReferenceWidget } = availableLegacyWidgets[\n\t\t\t\t\t\t\tnewWidget\n\t\t\t\t\t\t];\n\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\tinstance: {},\n\t\t\t\t\t\t\tid: isReferenceWidget ? newWidget : undefined,\n\t\t\t\t\t\t\twidgetClass: isReferenceWidget\n\t\t\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t\t\t: newWidget,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\n\t\tconst inspectorControls = widgetObject ? (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ widgetObject.name }>\n\t\t\t\t\t{ widgetObject.description }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t) : null;\n\t\tif ( ! hasPermissionsToManageWidgets ) {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t{ inspectorControls }\n\t\t\t\t\t{ this.renderWidgetPreview() }\n\t\t\t\t</>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t\t{ widgetObject && ! widgetObject.isHidden && (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={ this.changeWidget }\n\t\t\t\t\t\t\t\tlabel={ __( 'Change widget' ) }\n\t\t\t\t\t\t\t\ticon={ update }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t{ hasEditForm && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"components-tab-button\"\n\t\t\t\t\t\t\t\t\tisPressed={ ! isPreview }\n\t\t\t\t\t\t\t\t\tonClick={ this.switchToEdit }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span>{ __( 'Edit' ) }</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"components-tab-button\"\n\t\t\t\t\t\t\t\t\tisPressed={ isPreview }\n\t\t\t\t\t\t\t\t\tonClick={ this.switchToPreview }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span>{ __( 'Preview' ) }</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</ToolbarGroup>\n\t\t\t\t</BlockControls>\n\t\t\t\t{ inspectorControls }\n\t\t\t\t{ hasEditForm && (\n\t\t\t\t\t<LegacyWidgetEditHandler\n\t\t\t\t\t\tisSelected={ isSelected }\n\t\t\t\t\t\tisVisible={ ! isPreview }\n\t\t\t\t\t\tid={ id }\n\t\t\t\t\t\tidBase={ attributes.idBase || attributes.id }\n\t\t\t\t\t\tnumber={ attributes.number }\n\t\t\t\t\t\twidgetName={ get( widgetObject, [ 'name' ] ) }\n\t\t\t\t\t\twidgetClass={ attributes.widgetClass }\n\t\t\t\t\t\tinstance={ attributes.instance }\n\t\t\t\t\t\tonInstanceChange={ ( newInstance, newHasEditForm ) => {\n\t\t\t\t\t\t\tif ( newInstance ) {\n\t\t\t\t\t\t\t\tthis.props.setAttributes( {\n\t\t\t\t\t\t\t\t\tinstance: newInstance,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ( newHasEditForm !== this.hasEditForm ) {\n\t\t\t\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\t\t\t\thasEditForm: newHasEditForm,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ ( isPreview || ! hasEditForm ) && this.renderWidgetPreview() }\n\t\t\t</>\n\t\t);\n\t}\n\n\tchangeWidget() {\n\t\tthis.switchToEdit();\n\t\tthis.props.setAttributes( {\n\t\t\tinstance: {},\n\t\t\tid: undefined,\n\t\t\twidgetClass: undefined,\n\t\t} );\n\t\tthis.setState( {\n\t\t\thasEditForm: true,\n\t\t} );\n\t}\n\n\tswitchToEdit() {\n\t\tthis.setState( { isPreview: false } );\n\t}\n\n\tswitchToPreview() {\n\t\tthis.setState( { isPreview: true } );\n\t}\n\n\trenderWidgetPreview() {\n\t\tconst { attributes } = this.props;\n\t\treturn (\n\t\t\t<ServerSideRender\n\t\t\t\tclassName=\"wp-block-legacy-widget__preview\"\n\t\t\t\tblock=\"core/legacy-widget\"\n\t\t\t\tattributes={ attributes }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default withSelect( ( select ) => {\n\tconst editorSettings = select( 'core/block-editor' ).getSettings();\n\tconst {\n\t\tavailableLegacyWidgets,\n\t\thasPermissionsToManageWidgets,\n\t} = editorSettings;\n\treturn {\n\t\thasPermissionsToManageWidgets,\n\t\tavailableLegacyWidgets,\n\t};\n} )( LegacyWidgetEdit );\n"]}