{"version":3,"sources":["@wordpress/block-library/src/navigation-link/edit.js"],"names":["classnames","escape","get","head","find","compose","createBlock","withDispatch","withSelect","ExternalLink","KeyboardShortcuts","PanelBody","Popover","TextareaControl","ToggleControl","ToolbarButton","ToolbarGroup","rawShortcut","displayShortcut","__","BlockControls","InnerBlocks","InspectorControls","RichText","__experimentalLinkControl","LinkControl","__experimentalBlock","Block","isURL","prependHTTP","Fragment","useState","useEffect","useRef","placeCaretAtHorizontalEdge","link","linkIcon","ToolbarSubmenuIcon","ItemSubmenuIcon","NavigationLinkEdit","attributes","hasDescendants","isSelected","isImmediateParentOfSelectedBlock","isParentOfSelectedBlock","setAttributes","showSubmenuIcon","insertLinkBlock","textColor","backgroundColor","rgbTextColor","rgbBackgroundColor","saveEntityRecord","selectedBlockHasDescendants","userCanCreatePages","insertBlocksAfter","mergeBlocks","onReplace","label","opensInNewTab","url","nofollow","description","isLinkOpen","setIsLinkOpen","itemLabelPlaceholder","ref","test","selectLabelText","current","focus","selection","window","getSelection","range","document","createRange","selectNodeContents","removeAllRanges","addRange","handleCreatePage","pageTitle","type","title","status","page","id","rendered","primary","nofollowValue","descriptionValue","color","labelValue","undefined","newTitle","newURL","newOpensInNewTab","encodeURI","normalizedTitle","replace","normalizedURL","DefaultAppender","className","getColorObjectByColorSlug","colors","colorSlug","customColor","length","slug","select","ownProps","getBlockAttributes","getClientIdsOfDescendants","hasSelectedInnerBlock","getBlockParentsByBlockName","getSelectedBlockClientId","getSettings","clientId","rootBlock","navigationBlockAttributes","selectedBlockId","canUser","customTextColor","customBackgroundColor","dispatch","registry","insertBlock","navItems","insertionPoint","blockToInsert"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { escape, get, head, find } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { compose } from '@wordpress/compose';\nimport { createBlock } from '@wordpress/blocks';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport {\n\tExternalLink,\n\tKeyboardShortcuts,\n\tPanelBody,\n\tPopover,\n\tTextareaControl,\n\tToggleControl,\n\tToolbarButton,\n\tToolbarGroup,\n} from '@wordpress/components';\nimport { rawShortcut, displayShortcut } from '@wordpress/keycodes';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tBlockControls,\n\tInnerBlocks,\n\tInspectorControls,\n\tRichText,\n\t__experimentalLinkControl as LinkControl,\n\t__experimentalBlock as Block,\n} from '@wordpress/block-editor';\nimport { isURL, prependHTTP } from '@wordpress/url';\nimport { Fragment, useState, useEffect, useRef } from '@wordpress/element';\nimport { placeCaretAtHorizontalEdge } from '@wordpress/dom';\nimport { link as linkIcon } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport { ToolbarSubmenuIcon, ItemSubmenuIcon } from './icons';\n\nfunction NavigationLinkEdit( {\n\tattributes,\n\thasDescendants,\n\tisSelected,\n\tisImmediateParentOfSelectedBlock,\n\tisParentOfSelectedBlock,\n\tsetAttributes,\n\tshowSubmenuIcon,\n\tinsertLinkBlock,\n\ttextColor,\n\tbackgroundColor,\n\trgbTextColor,\n\trgbBackgroundColor,\n\tsaveEntityRecord,\n\tselectedBlockHasDescendants,\n\tuserCanCreatePages = false,\n\tinsertBlocksAfter,\n\tmergeBlocks,\n\tonReplace,\n} ) {\n\tconst { label, opensInNewTab, url, nofollow, description } = attributes;\n\tconst link = {\n\t\turl,\n\t\topensInNewTab,\n\t};\n\tconst [ isLinkOpen, setIsLinkOpen ] = useState( false );\n\tconst itemLabelPlaceholder = __( 'Add link…' );\n\tconst ref = useRef();\n\n\t// Show the LinkControl on mount if the URL is empty\n\t// ( When adding a new menu item)\n\t// This can't be done in the useState call because it cconflicts\n\t// with the autofocus behavior of the BlockListBlock component.\n\tuseEffect( () => {\n\t\tif ( ! url ) {\n\t\t\tsetIsLinkOpen( true );\n\t\t}\n\t}, [] );\n\n\t/**\n\t * The hook shouldn't be necessary but due to a focus loss happening\n\t * when selecting a suggestion in the link popover, we force close on block unselection.\n\t */\n\tuseEffect( () => {\n\t\tif ( ! isSelected ) {\n\t\t\tsetIsLinkOpen( false );\n\t\t}\n\t}, [ isSelected ] );\n\n\t// If the LinkControl popover is open and the URL has changed, close the LinkControl and focus the label text.\n\tuseEffect( () => {\n\t\tif ( isLinkOpen && url ) {\n\t\t\t// Does this look like a URL and have something TLD-ish?\n\t\t\tif (\n\t\t\t\tisURL( prependHTTP( label ) ) &&\n\t\t\t\t/^.+\\.[a-z]+/.test( label )\n\t\t\t) {\n\t\t\t\t// Focus and select the label text.\n\t\t\t\tselectLabelText();\n\t\t\t} else {\n\t\t\t\t// Focus it (but do not select).\n\t\t\t\tplaceCaretAtHorizontalEdge( ref.current, true );\n\t\t\t}\n\t\t}\n\t}, [ url ] );\n\n\t/**\n\t * Focus the navigation link label text and select it.\n\t */\n\tfunction selectLabelText() {\n\t\tref.current.focus();\n\t\tconst selection = window.getSelection();\n\t\tconst range = document.createRange();\n\t\t// Get the range of the current ref contents so we can add this range to the selection.\n\t\trange.selectNodeContents( ref.current );\n\t\tselection.removeAllRanges();\n\t\tselection.addRange( range );\n\t}\n\n\tasync function handleCreatePage( pageTitle ) {\n\t\tconst type = 'page';\n\t\tconst page = await saveEntityRecord( 'postType', type, {\n\t\t\ttitle: pageTitle,\n\t\t\tstatus: 'publish',\n\t\t} );\n\n\t\treturn {\n\t\t\tid: page.id,\n\t\t\ttype,\n\t\t\ttitle: page.title.rendered,\n\t\t\turl: page.link,\n\t\t};\n\t}\n\n\treturn (\n\t\t<Fragment>\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<KeyboardShortcuts\n\t\t\t\t\t\tbindGlobal\n\t\t\t\t\t\tshortcuts={ {\n\t\t\t\t\t\t\t[ rawShortcut.primary( 'k' ) ]: () =>\n\t\t\t\t\t\t\t\tsetIsLinkOpen( true ),\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\tname=\"link\"\n\t\t\t\t\t\ticon={ linkIcon }\n\t\t\t\t\t\ttitle={ __( 'Link' ) }\n\t\t\t\t\t\tshortcut={ displayShortcut.primary( 'k' ) }\n\t\t\t\t\t\tonClick={ () => setIsLinkOpen( true ) }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\tname=\"submenu\"\n\t\t\t\t\t\ticon={ <ToolbarSubmenuIcon /> }\n\t\t\t\t\t\ttitle={ __( 'Add submenu' ) }\n\t\t\t\t\t\tonClick={ insertLinkBlock }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t</BlockControls>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'SEO settings' ) }>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tchecked={ nofollow }\n\t\t\t\t\t\tonChange={ ( nofollowValue ) => {\n\t\t\t\t\t\t\tsetAttributes( { nofollow: nofollowValue } );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tlabel={ __( 'Add nofollow to link' ) }\n\t\t\t\t\t\thelp={\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\"Don't let search engines follow this link.\"\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\t\t\tclassName=\"wp-block-navigation-link__nofollow-external-link\"\n\t\t\t\t\t\t\t\t\thref={ __(\n\t\t\t\t\t\t\t\t\t\t'https://codex.wordpress.org/Nofollow'\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ __( \"What's this?\" ) }\n\t\t\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody title={ __( 'Link settings' ) }>\n\t\t\t\t\t<TextareaControl\n\t\t\t\t\t\tvalue={ description || '' }\n\t\t\t\t\t\tonChange={ ( descriptionValue ) => {\n\t\t\t\t\t\t\tsetAttributes( { description: descriptionValue } );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tlabel={ __( 'Description' ) }\n\t\t\t\t\t\thelp={ __(\n\t\t\t\t\t\t\t'The description will be displayed in the menu if the current theme supports it.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t<Block.li\n\t\t\t\tclassName={ classnames( {\n\t\t\t\t\t'is-editing': isSelected || isParentOfSelectedBlock,\n\t\t\t\t\t'is-selected': isSelected,\n\t\t\t\t\t'has-link': !! url,\n\t\t\t\t\t'has-child': hasDescendants,\n\t\t\t\t\t'has-text-color': rgbTextColor,\n\t\t\t\t\t[ `has-${ textColor }-color` ]: !! textColor,\n\t\t\t\t\t'has-background': rgbBackgroundColor,\n\t\t\t\t\t[ `has-${ backgroundColor }-background-color` ]: !! backgroundColor,\n\t\t\t\t} ) }\n\t\t\t\tstyle={ {\n\t\t\t\t\tcolor: rgbTextColor,\n\t\t\t\t\tbackgroundColor: rgbBackgroundColor,\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t<div className=\"wp-block-navigation-link__content\">\n\t\t\t\t\t<RichText\n\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\tidentifier=\"label\"\n\t\t\t\t\t\tclassName=\"wp-block-navigation-link__label\"\n\t\t\t\t\t\tvalue={ label }\n\t\t\t\t\t\tonChange={ ( labelValue ) =>\n\t\t\t\t\t\t\tsetAttributes( { label: labelValue } )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonMerge={ mergeBlocks }\n\t\t\t\t\t\tonReplace={ onReplace }\n\t\t\t\t\t\t__unstableOnSplitAtEnd={ () =>\n\t\t\t\t\t\t\tinsertBlocksAfter(\n\t\t\t\t\t\t\t\tcreateBlock( 'core/navigation-link' )\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tplaceholder={ itemLabelPlaceholder }\n\t\t\t\t\t\tkeepPlaceholderOnFocus\n\t\t\t\t\t\twithoutInteractiveFormatting\n\t\t\t\t\t\tallowedFormats={ [\n\t\t\t\t\t\t\t'core/bold',\n\t\t\t\t\t\t\t'core/italic',\n\t\t\t\t\t\t\t'core/image',\n\t\t\t\t\t\t\t'core/strikethrough',\n\t\t\t\t\t\t] }\n\t\t\t\t\t/>\n\t\t\t\t\t{ isLinkOpen && (\n\t\t\t\t\t\t<Popover\n\t\t\t\t\t\t\tposition=\"bottom center\"\n\t\t\t\t\t\t\tonClose={ () => setIsLinkOpen( false ) }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<LinkControl\n\t\t\t\t\t\t\t\tclassName=\"wp-block-navigation-link__inline-link-input\"\n\t\t\t\t\t\t\t\tvalue={ link }\n\t\t\t\t\t\t\t\tshowInitialSuggestions={ true }\n\t\t\t\t\t\t\t\tcreateSuggestion={\n\t\t\t\t\t\t\t\t\tuserCanCreatePages\n\t\t\t\t\t\t\t\t\t\t? handleCreatePage\n\t\t\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tonChange={ ( {\n\t\t\t\t\t\t\t\t\ttitle: newTitle = '',\n\t\t\t\t\t\t\t\t\turl: newURL = '',\n\t\t\t\t\t\t\t\t\topensInNewTab: newOpensInNewTab,\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t} = {} ) =>\n\t\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\t\turl: encodeURI( newURL ),\n\t\t\t\t\t\t\t\t\t\tlabel: ( () => {\n\t\t\t\t\t\t\t\t\t\t\tconst normalizedTitle = newTitle.replace(\n\t\t\t\t\t\t\t\t\t\t\t\t/http(s?):\\/\\//gi,\n\t\t\t\t\t\t\t\t\t\t\t\t''\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\tconst normalizedURL = newURL.replace(\n\t\t\t\t\t\t\t\t\t\t\t\t/http(s?):\\/\\//gi,\n\t\t\t\t\t\t\t\t\t\t\t\t''\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t\tnewTitle !== '' &&\n\t\t\t\t\t\t\t\t\t\t\t\tnormalizedTitle !==\n\t\t\t\t\t\t\t\t\t\t\t\t\tnormalizedURL &&\n\t\t\t\t\t\t\t\t\t\t\t\tlabel !== newTitle\n\t\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn escape( newTitle );\n\t\t\t\t\t\t\t\t\t\t\t} else if ( label ) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn label;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t// If there's no label, add the URL.\n\t\t\t\t\t\t\t\t\t\t\treturn escape( normalizedURL );\n\t\t\t\t\t\t\t\t\t\t} )(),\n\t\t\t\t\t\t\t\t\t\topensInNewTab: newOpensInNewTab,\n\t\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Popover>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t\t{ showSubmenuIcon && (\n\t\t\t\t\t<span className=\"wp-block-navigation-link__submenu-icon\">\n\t\t\t\t\t\t<ItemSubmenuIcon />\n\t\t\t\t\t</span>\n\t\t\t\t) }\n\t\t\t\t<InnerBlocks\n\t\t\t\t\tallowedBlocks={ [ 'core/navigation-link' ] }\n\t\t\t\t\trenderAppender={\n\t\t\t\t\t\t( isSelected && hasDescendants ) ||\n\t\t\t\t\t\t( isImmediateParentOfSelectedBlock &&\n\t\t\t\t\t\t\t! selectedBlockHasDescendants )\n\t\t\t\t\t\t\t? InnerBlocks.DefaultAppender\n\t\t\t\t\t\t\t: false\n\t\t\t\t\t}\n\t\t\t\t\t__experimentalTagName=\"ul\"\n\t\t\t\t\t__experimentalAppenderTagName=\"li\"\n\t\t\t\t\t__experimentalPassedProps={ {\n\t\t\t\t\t\tclassName: classnames(\n\t\t\t\t\t\t\t'wp-block-navigation__container',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t'is-parent-of-selected-block': isParentOfSelectedBlock,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t),\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t</Block.li>\n\t\t</Fragment>\n\t);\n}\n\n/**\n * Returns the color object matching the slug, or undefined.\n *\n * @param {Array}  colors      The editor settings colors array.\n * @param {string} colorSlug   A string containing the color slug.\n * @param {string} customColor A string containing the custom color value.\n *\n * @return {Object} Color object included in the editor settings colors, or Undefined.\n */\nconst getColorObjectByColorSlug = ( colors, colorSlug, customColor ) => {\n\tif ( customColor ) {\n\t\treturn customColor;\n\t}\n\n\tif ( ! colors || ! colors.length ) {\n\t\treturn;\n\t}\n\n\treturn get( find( colors, { slug: colorSlug } ), 'color' );\n};\n\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tgetBlockAttributes,\n\t\t\tgetClientIdsOfDescendants,\n\t\t\thasSelectedInnerBlock,\n\t\t\tgetBlockParentsByBlockName,\n\t\t\tgetSelectedBlockClientId,\n\t\t\tgetSettings,\n\t\t} = select( 'core/block-editor' );\n\t\tconst { clientId } = ownProps;\n\t\tconst rootBlock = head(\n\t\t\tgetBlockParentsByBlockName( clientId, 'core/navigation' )\n\t\t);\n\t\tconst navigationBlockAttributes = getBlockAttributes( rootBlock );\n\t\tconst colors = get( getSettings(), 'colors', [] );\n\t\tconst hasDescendants = !! getClientIdsOfDescendants( [ clientId ] )\n\t\t\t.length;\n\t\tconst showSubmenuIcon =\n\t\t\t!! navigationBlockAttributes.showSubmenuIcon && hasDescendants;\n\t\tconst isParentOfSelectedBlock = hasSelectedInnerBlock( clientId, true );\n\t\tconst isImmediateParentOfSelectedBlock = hasSelectedInnerBlock(\n\t\t\tclientId,\n\t\t\tfalse\n\t\t);\n\t\tconst selectedBlockId = getSelectedBlockClientId();\n\t\tconst selectedBlockHasDescendants = !! getClientIdsOfDescendants( [\n\t\t\tselectedBlockId,\n\t\t] )?.length;\n\n\t\tconst userCanCreatePages = select( 'core' ).canUser(\n\t\t\t'create',\n\t\t\t'pages'\n\t\t);\n\n\t\treturn {\n\t\t\tisParentOfSelectedBlock,\n\t\t\tisImmediateParentOfSelectedBlock,\n\t\t\thasDescendants,\n\t\t\tselectedBlockHasDescendants,\n\t\t\tshowSubmenuIcon,\n\t\t\ttextColor: navigationBlockAttributes.textColor,\n\t\t\tbackgroundColor: navigationBlockAttributes.backgroundColor,\n\t\t\tuserCanCreatePages,\n\t\t\trgbTextColor: getColorObjectByColorSlug(\n\t\t\t\tcolors,\n\t\t\t\tnavigationBlockAttributes.textColor,\n\t\t\t\tnavigationBlockAttributes.customTextColor\n\t\t\t),\n\t\t\trgbBackgroundColor: getColorObjectByColorSlug(\n\t\t\t\tcolors,\n\t\t\t\tnavigationBlockAttributes.backgroundColor,\n\t\t\t\tnavigationBlockAttributes.customBackgroundColor\n\t\t\t),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps, registry ) => {\n\t\tconst { saveEntityRecord } = dispatch( 'core' );\n\t\treturn {\n\t\t\tsaveEntityRecord,\n\t\t\tinsertLinkBlock() {\n\t\t\t\tconst { clientId } = ownProps;\n\n\t\t\t\tconst { insertBlock } = dispatch( 'core/block-editor' );\n\n\t\t\t\tconst { getClientIdsOfDescendants } = registry.select(\n\t\t\t\t\t'core/block-editor'\n\t\t\t\t);\n\t\t\t\tconst navItems = getClientIdsOfDescendants( [ clientId ] );\n\t\t\t\tconst insertionPoint = navItems.length ? navItems.length : 0;\n\n\t\t\t\tconst blockToInsert = createBlock( 'core/navigation-link' );\n\n\t\t\t\tinsertBlock( blockToInsert, insertionPoint, clientId );\n\t\t\t},\n\t\t};\n\t} ),\n] )( NavigationLinkEdit );\n"]}