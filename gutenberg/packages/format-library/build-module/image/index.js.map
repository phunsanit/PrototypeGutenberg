{"version":3,"sources":["@wordpress/format-library/src/image/index.js"],"names":["Path","SVG","TextControl","Popover","Button","__","Component","insertObject","MediaUpload","RichTextToolbarButton","MediaUploadCheck","LEFT","RIGHT","UP","DOWN","BACKSPACE","ENTER","keyboardReturn","ALLOWED_MEDIA_TYPES","name","title","stopKeyPropagation","event","stopPropagation","getRange","selection","window","getSelection","rangeCount","getRangeAt","image","keywords","object","tagName","className","attributes","style","url","alt","edit","arguments","onChange","bind","onKeyDown","openModal","closeModal","anchorRef","state","modal","width","setState","indexOf","keyCode","prevProps","isObjectActive","props","activeObjectAttributes","value","onFocus","id","type","Math","min","open","newReplacements","replacements","slice","start","preventDefault","previousStyle","undefined","replace"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Path, SVG, TextControl, Popover, Button } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { insertObject } from '@wordpress/rich-text';\nimport {\n\tMediaUpload,\n\tRichTextToolbarButton,\n\tMediaUploadCheck,\n} from '@wordpress/block-editor';\nimport { LEFT, RIGHT, UP, DOWN, BACKSPACE, ENTER } from '@wordpress/keycodes';\nimport { keyboardReturn } from '@wordpress/icons';\n\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nconst name = 'core/image';\nconst title = __( 'Inline image' );\n\nconst stopKeyPropagation = ( event ) => event.stopPropagation();\n\nfunction getRange() {\n\tconst selection = window.getSelection();\n\treturn selection.rangeCount ? selection.getRangeAt( 0 ) : null;\n}\n\nexport const image = {\n\tname,\n\ttitle,\n\tkeywords: [ __( 'photo' ), __( 'media' ) ],\n\tobject: true,\n\ttagName: 'img',\n\tclassName: null,\n\tattributes: {\n\t\tclassName: 'class',\n\t\tstyle: 'style',\n\t\turl: 'src',\n\t\talt: 'alt',\n\t},\n\tedit: class ImageEdit extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\t\t\tthis.onChange = this.onChange.bind( this );\n\t\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\t\tthis.openModal = this.openModal.bind( this );\n\t\t\tthis.closeModal = this.closeModal.bind( this );\n\t\t\tthis.anchorRef = null;\n\t\t\tthis.state = {\n\t\t\t\tmodal: false,\n\t\t\t};\n\t\t}\n\n\t\tstatic getDerivedStateFromProps( props, state ) {\n\t\t\tconst {\n\t\t\t\tactiveObjectAttributes: { style },\n\t\t\t} = props;\n\n\t\t\tif ( style === state.previousStyle ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif ( ! style ) {\n\t\t\t\treturn {\n\t\t\t\t\twidth: undefined,\n\t\t\t\t\tpreviousStyle: style,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\twidth: style.replace( /\\D/g, '' ),\n\t\t\t\tpreviousStyle: style,\n\t\t\t};\n\t\t}\n\n\t\tonChange( width ) {\n\t\t\tthis.setState( { width } );\n\t\t}\n\n\t\tonKeyDown( event ) {\n\t\t\tif (\n\t\t\t\t[ LEFT, DOWN, RIGHT, UP, BACKSPACE, ENTER ].indexOf(\n\t\t\t\t\tevent.keyCode\n\t\t\t\t) > -1\n\t\t\t) {\n\t\t\t\t// Stop the key event from propagating up to ObserveTyping.startTypingInTextField.\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t}\n\n\t\topenModal() {\n\t\t\tthis.setState( { modal: true } );\n\t\t}\n\n\t\tcloseModal() {\n\t\t\tthis.setState( { modal: false } );\n\t\t}\n\n\t\tcomponentDidMount() {\n\t\t\tthis.anchorRef = getRange();\n\t\t}\n\n\t\tcomponentDidUpdate( prevProps ) {\n\t\t\t// When the popover is open or when the selected image changes,\n\t\t\t// update the anchorRef.\n\t\t\tif (\n\t\t\t\t( ! prevProps.isObjectActive && this.props.isObjectActive ) ||\n\t\t\t\tprevProps.activeObjectAttributes.url !==\n\t\t\t\t\tthis.props.activeObjectAttributes.url\n\t\t\t) {\n\t\t\t\tthis.anchorRef = getRange();\n\t\t\t}\n\t\t}\n\n\t\trender() {\n\t\t\tconst {\n\t\t\t\tvalue,\n\t\t\t\tonChange,\n\t\t\t\tonFocus,\n\t\t\t\tisObjectActive,\n\t\t\t\tactiveObjectAttributes,\n\t\t\t} = this.props;\n\n\t\t\treturn (\n\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t<RichTextToolbarButton\n\t\t\t\t\t\ticon={\n\t\t\t\t\t\t\t<SVG\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Path d=\"M4 18.5h16V17H4v1.5zM16 13v1.5h4V13h-4zM5.1 15h7.8c.6 0 1.1-.5 1.1-1.1V6.1c0-.6-.5-1.1-1.1-1.1H5.1C4.5 5 4 5.5 4 6.1v7.8c0 .6.5 1.1 1.1 1.1zm.4-8.5h7V10l-1-1c-.3-.3-.8-.3-1 0l-1.6 1.5-1.2-.7c-.3-.2-.6-.2-.9 0l-1.3 1V6.5zm0 6.1l1.8-1.3 1.3.8c.3.2.7.2.9-.1l1.5-1.4 1.5 1.4v1.5h-7v-.9z\" />\n\t\t\t\t\t\t\t</SVG>\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={ title }\n\t\t\t\t\t\tonClick={ this.openModal }\n\t\t\t\t\t\tisActive={ isObjectActive }\n\t\t\t\t\t/>\n\t\t\t\t\t{ this.state.modal && (\n\t\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\t\tonSelect={ ( { id, url, alt, width } ) => {\n\t\t\t\t\t\t\t\tthis.closeModal();\n\t\t\t\t\t\t\t\tonChange(\n\t\t\t\t\t\t\t\t\tinsertObject( value, {\n\t\t\t\t\t\t\t\t\t\ttype: name,\n\t\t\t\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\t\t\t\tclassName: `wp-image-${ id }`,\n\t\t\t\t\t\t\t\t\t\t\tstyle: `width: ${ Math.min(\n\t\t\t\t\t\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\t\t\t\t\t\t150\n\t\t\t\t\t\t\t\t\t\t\t) }px;`,\n\t\t\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\t\t\talt,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tonFocus();\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tonClose={ this.closeModal }\n\t\t\t\t\t\t\trender={ ( { open } ) => {\n\t\t\t\t\t\t\t\topen();\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ isObjectActive && (\n\t\t\t\t\t\t<Popover\n\t\t\t\t\t\t\tposition=\"bottom center\"\n\t\t\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\t\t\tanchorRef={ this.anchorRef }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t// Disable reason: KeyPress must be suppressed so the block doesn't hide the toolbar\n\t\t\t\t\t\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */\n\t\t\t\t\t\t\t }\n\t\t\t\t\t\t\t<form\n\t\t\t\t\t\t\t\tclassName=\"block-editor-format-toolbar__image-container-content\"\n\t\t\t\t\t\t\t\tonKeyPress={ stopKeyPropagation }\n\t\t\t\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\t\t\t\tonSubmit={ ( event ) => {\n\t\t\t\t\t\t\t\t\tconst newReplacements = value.replacements.slice();\n\n\t\t\t\t\t\t\t\t\tnewReplacements[ value.start ] = {\n\t\t\t\t\t\t\t\t\t\ttype: name,\n\t\t\t\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\t\t\t\t...activeObjectAttributes,\n\t\t\t\t\t\t\t\t\t\t\tstyle: `width: ${ this.state.width }px;`,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tonChange( {\n\t\t\t\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t\t\t\t\treplacements: newReplacements,\n\t\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\t\tclassName=\"block-editor-format-toolbar__image-container-value\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Width' ) }\n\t\t\t\t\t\t\t\t\tvalue={ this.state.width }\n\t\t\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\ticon={ keyboardReturn }\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Apply' ) }\n\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t{ /* eslint-enable jsx-a11y/no-noninteractive-element-interactions */ }\n\t\t\t\t\t\t</Popover>\n\t\t\t\t\t) }\n\t\t\t\t</MediaUploadCheck>\n\t\t\t);\n\t\t}\n\t},\n};\n"]}