{"version":3,"sources":["@wordpress/format-library/src/link/modal.native.js"],"names":["React","Platform","__","Component","prependHTTP","BottomSheet","withSpokenMessages","create","insert","isCollapsed","applyFormat","getTextContent","slice","external","link","textColor","createLinkFormat","isValidHref","styles","ModalLinkUI","arguments","submitLink","bind","onChangeInputValue","onChangeText","onChangeOpensInNewWindow","removeLink","onDismiss","state","inputValue","text","opensInNewWindow","oldProps","props","activeAttributes","url","target","setState","value","isActive","onChange","speak","linkText","format","toInsert","length","newAttributes","needsSelectionUpdate","start","end","onClose","onRemove","isVisible","OS","clearLinkButton"],"mappings":";;;;;;;;;;;;;;;;;AAAA;;;AAGA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,QAAT,QAAyB,cAAzB;AAEA;;;;AAGA,SAASC,EAAT,QAAmB,iBAAnB;AACA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,WAAT,QAA4B,gBAA5B;AACA,SAASC,WAAT,EAAsBC,kBAAtB,QAAgD,uBAAhD;AACA,SACCC,MADD,EAECC,MAFD,EAGCC,WAHD,EAICC,WAJD,EAKCC,cALD,EAMCC,KAND,QAOO,sBAPP;AAQA,SAASC,QAAT,EAAmBC,IAAnB,EAAyBC,SAAzB,QAA0C,kBAA1C;AAEA;;;;AAGA,SAASC,gBAAT,EAA2BC,WAA3B,QAA8C,SAA9C;AAEA,OAAOC,MAAP,MAAmB,cAAnB;;IAEMC,W;;;;;AACL,yBAAc;AAAA;;AAAA;;AACb,+BAAUC,SAAV;AAEA,UAAKC,UAAL,GAAkB,MAAKA,UAAL,CAAgBC,IAAhB,+BAAlB;AACA,UAAKC,kBAAL,GAA0B,MAAKA,kBAAL,CAAwBD,IAAxB,+BAA1B;AACA,UAAKE,YAAL,GAAoB,MAAKA,YAAL,CAAkBF,IAAlB,+BAApB;AACA,UAAKG,wBAAL,GAAgC,MAAKA,wBAAL,CAA8BH,IAA9B,+BAAhC;AAGA,UAAKI,UAAL,GAAkB,MAAKA,UAAL,CAAgBJ,IAAhB,+BAAlB;AACA,UAAKK,SAAL,GAAiB,MAAKA,SAAL,CAAeL,IAAf,+BAAjB;AAEA,UAAKM,KAAL,GAAa;AACZC,MAAAA,UAAU,EAAE,EADA;AAEZC,MAAAA,IAAI,EAAE,EAFM;AAGZC,MAAAA,gBAAgB,EAAE;AAHN,KAAb;AAZa;AAiBb;;;;uCAEmBC,Q,EAAW;AAC9B,UAAKA,QAAQ,KAAK,KAAKC,KAAvB,EAA+B;AAC9B;AACA;;AAH6B,kCAO1B,KAAKA,KAPqB,CAM7BC,gBAN6B;AAAA,UAMTC,GANS,yBAMTA,GANS;AAAA,UAMJC,MANI,yBAMJA,MANI;AAQ9B,UAAML,gBAAgB,GAAGK,MAAM,KAAK,QAApC;AAEA,WAAKC,QAAL,CAAe;AACdR,QAAAA,UAAU,EAAEM,GAAG,IAAI,EADL;AAEdL,QAAAA,IAAI,EAAEnB,cAAc,CAAEC,KAAK,CAAE,KAAKqB,KAAL,CAAWK,KAAb,CAAP,CAFN;AAGdP,QAAAA,gBAAgB,EAAhBA;AAHc,OAAf;AAKA;;;uCAEmBF,U,EAAa;AAChC,WAAKQ,QAAL,CAAe;AAAER,QAAAA,UAAU,EAAVA;AAAF,OAAf;AACA;;;iCAEaC,I,EAAO;AACpB,WAAKO,QAAL,CAAe;AAAEP,QAAAA,IAAI,EAAJA;AAAF,OAAf;AACA;;;6CAEyBC,gB,EAAmB;AAC5C,WAAKM,QAAL,CAAe;AAAEN,QAAAA,gBAAgB,EAAhBA;AAAF,OAAf;AACA;;;iCAEY;AAAA,wBACiC,KAAKE,KADtC;AAAA,UACJM,QADI,eACJA,QADI;AAAA,UACMC,QADN,eACMA,QADN;AAAA,UACgBC,KADhB,eACgBA,KADhB;AAAA,UACuBH,KADvB,eACuBA,KADvB;AAAA,wBAEmC,KAAKV,KAFxC;AAAA,UAEJC,UAFI,eAEJA,UAFI;AAAA,UAEQE,gBAFR,eAEQA,gBAFR;AAAA,UAE0BD,IAF1B,eAE0BA,IAF1B;AAGZ,UAAMK,GAAG,GAAG/B,WAAW,CAAEyB,UAAF,CAAvB;AACA,UAAMa,QAAQ,GAAGZ,IAAI,IAAID,UAAzB;AACA,UAAMc,MAAM,GAAG3B,gBAAgB,CAAE;AAChCmB,QAAAA,GAAG,EAAHA,GADgC;AAEhCJ,QAAAA,gBAAgB,EAAhBA,gBAFgC;AAGhCD,QAAAA,IAAI,EAAEY;AAH0B,OAAF,CAA/B;;AAMA,UAAKjC,WAAW,CAAE6B,KAAF,CAAX,IAAwB,CAAEC,QAA/B,EAA0C;AACzC;AACA,YAAMK,QAAQ,GAAGlC,WAAW,CAC3BH,MAAM,CAAE;AAAEuB,UAAAA,IAAI,EAAEY;AAAR,SAAF,CADqB,EAE3BC,MAF2B,EAG3B,CAH2B,EAI3BD,QAAQ,CAACG,MAJkB,CAA5B;AAMA,YAAMC,aAAa,GAAGtC,MAAM,CAAE8B,KAAF,EAASM,QAAT,CAA5B;AACAJ,QAAAA,QAAQ,mBAAOM,aAAP;AAAsBC,UAAAA,oBAAoB,EAAE;AAA5C,WAAR;AACA,OAVD,MAUO,IAAKjB,IAAI,KAAKnB,cAAc,CAAEC,KAAK,CAAE0B,KAAF,CAAP,CAA5B,EAAiD;AACvD;AACA,YAAMM,SAAQ,GAAGlC,WAAW,CAC3BH,MAAM,CAAE;AAAEuB,UAAAA,IAAI,EAAJA;AAAF,SAAF,CADqB,EAE3Ba,MAF2B,EAG3B,CAH2B,EAI3Bb,IAAI,CAACe,MAJsB,CAA5B;;AAMA,YAAMC,cAAa,GAAGtC,MAAM,CAC3B8B,KAD2B,EAE3BM,SAF2B,EAG3BN,KAAK,CAACU,KAHqB,EAI3BV,KAAK,CAACW,GAJqB,CAA5B;;AAMAT,QAAAA,QAAQ,mBAAOM,cAAP;AAAsBC,UAAAA,oBAAoB,EAAE;AAA5C,WAAR;AACA,OAfM,MAeA;AACN;AACA,YAAMD,eAAa,GAAGpC,WAAW,CAAE4B,KAAF,EAASK,MAAT,CAAjC;;AACAH,QAAAA,QAAQ,mBAAOM,eAAP;AAAsBC,UAAAA,oBAAoB,EAAE;AAA5C,WAAR;AACA;;AAED,UAAK,CAAE9B,WAAW,CAAEkB,GAAF,CAAlB,EAA4B;AAC3BM,QAAAA,KAAK,CACJvC,EAAE,CACD,0EADC,CADE,EAIJ,WAJI,CAAL;AAMA,OAPD,MAOO,IAAKqC,QAAL,EAAgB;AACtBE,QAAAA,KAAK,CAAEvC,EAAE,CAAE,cAAF,CAAJ,EAAwB,WAAxB,CAAL;AACA,OAFM,MAEA;AACNuC,QAAAA,KAAK,CAAEvC,EAAE,CAAE,eAAF,CAAJ,EAAyB,WAAzB,CAAL;AACA;;AAED,WAAK+B,KAAL,CAAWiB,OAAX;AACA;;;iCAEY;AACZ,WAAKjB,KAAL,CAAWkB,QAAX;AACA,WAAKlB,KAAL,CAAWiB,OAAX;AACA;;;gCAEW;AACX,UAAK,KAAKtB,KAAL,CAAWC,UAAX,KAA0B,EAA/B,EAAoC;AACnC,aAAKH,UAAL;AACA,OAFD,MAEO;AACN,aAAKL,UAAL;AACA;AACD;;;6BAEQ;AAAA,UACA+B,SADA,GACc,KAAKnB,KADnB,CACAmB,SADA;AAAA,UAEAtB,IAFA,GAES,KAAKF,KAFd,CAEAE,IAFA;AAIR,aACC,cAAC,WAAD;AACC,QAAA,SAAS,EAAGsB,SADb;AAEC,QAAA,OAAO,EAAG,KAAKzB,SAFhB;AAGC,QAAA,UAAU;AAHX;AAME;AACA,oBAAC,WAAD,CAAa,IAAb;AACC,QAAA,IAAI,EAAGb,IADR;AAEC,QAAA,KAAK,EAAGZ,EAAE,CAAE,KAAF,CAFX;AAGC,QAAA,KAAK,EAAG,KAAK0B,KAAL,CAAWC,UAHpB;AAIC,QAAA,WAAW,EAAG3B,EAAE,CAAE,SAAF,CAJjB;AAKC,QAAA,cAAc,EAAC,MALhB;AAMC,QAAA,WAAW,EAAG,KANf;AAOC,QAAA,YAAY,EAAC,KAPd;AAQC,QAAA,aAAa,EAAG,KAAKqB,kBARtB;AASC,QAAA,QAAQ,EAAG,KAAKI,SATjB;AAUC,QAAA,SAAS,EAAG1B,QAAQ,CAACoD,EAAT,KAAgB;AAV7B;AAYA;AAnBF,QAqBC,cAAC,WAAD,CAAa,IAAb;AACC,QAAA,IAAI,EAAGtC,SADR;AAEC,QAAA,KAAK,EAAGb,EAAE,CAAE,WAAF,CAFX;AAGC,QAAA,KAAK,EAAG4B,IAHT;AAIC,QAAA,WAAW,EAAG5B,EAAE,CAAE,eAAF,CAJjB;AAKC,QAAA,aAAa,EAAG,KAAKsB,YALtB;AAMC,QAAA,QAAQ,EAAG,KAAKG;AANjB,QArBD,EA6BC,cAAC,WAAD,CAAa,UAAb;AACC,QAAA,IAAI,EAAGd,QADR;AAEC,QAAA,KAAK,EAAGX,EAAE,CAAE,iBAAF,CAFX;AAGC,QAAA,KAAK,EAAG,KAAK0B,KAAL,CAAWG,gBAHpB;AAIC,QAAA,aAAa,EAAG,KAAKN,wBAJtB;AAKC,QAAA,aAAa,EAAG;AALjB,QA7BD,EAoCC,cAAC,WAAD,CAAa,IAAb;AACC,QAAA,KAAK,EAAGvB,EAAE,CAAE,aAAF,CADX;AAEC,QAAA,UAAU,EAAGgB,MAAM,CAACoC,eAFrB;AAGC,QAAA,aAAa,EAAG,MAHjB;AAIC,QAAA,OAAO,EAAG,KAAK5B;AAJhB,QApCD,CADD;AA6CA;;;;EAzKwBvB,S;;AA4K1B,eAAeG,kBAAkB,CAAEa,WAAF,CAAjC","sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\nimport { Platform } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { prependHTTP } from '@wordpress/url';\nimport { BottomSheet, withSpokenMessages } from '@wordpress/components';\nimport {\n\tcreate,\n\tinsert,\n\tisCollapsed,\n\tapplyFormat,\n\tgetTextContent,\n\tslice,\n} from '@wordpress/rich-text';\nimport { external, link, textColor } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport { createLinkFormat, isValidHref } from './utils';\n\nimport styles from './modal.scss';\n\nclass ModalLinkUI extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.submitLink = this.submitLink.bind( this );\n\t\tthis.onChangeInputValue = this.onChangeInputValue.bind( this );\n\t\tthis.onChangeText = this.onChangeText.bind( this );\n\t\tthis.onChangeOpensInNewWindow = this.onChangeOpensInNewWindow.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.removeLink = this.removeLink.bind( this );\n\t\tthis.onDismiss = this.onDismiss.bind( this );\n\n\t\tthis.state = {\n\t\t\tinputValue: '',\n\t\t\ttext: '',\n\t\t\topensInNewWindow: false,\n\t\t};\n\t}\n\n\tcomponentDidUpdate( oldProps ) {\n\t\tif ( oldProps === this.props ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tactiveAttributes: { url, target },\n\t\t} = this.props;\n\t\tconst opensInNewWindow = target === '_blank';\n\n\t\tthis.setState( {\n\t\t\tinputValue: url || '',\n\t\t\ttext: getTextContent( slice( this.props.value ) ),\n\t\t\topensInNewWindow,\n\t\t} );\n\t}\n\n\tonChangeInputValue( inputValue ) {\n\t\tthis.setState( { inputValue } );\n\t}\n\n\tonChangeText( text ) {\n\t\tthis.setState( { text } );\n\t}\n\n\tonChangeOpensInNewWindow( opensInNewWindow ) {\n\t\tthis.setState( { opensInNewWindow } );\n\t}\n\n\tsubmitLink() {\n\t\tconst { isActive, onChange, speak, value } = this.props;\n\t\tconst { inputValue, opensInNewWindow, text } = this.state;\n\t\tconst url = prependHTTP( inputValue );\n\t\tconst linkText = text || inputValue;\n\t\tconst format = createLinkFormat( {\n\t\t\turl,\n\t\t\topensInNewWindow,\n\t\t\ttext: linkText,\n\t\t} );\n\n\t\tif ( isCollapsed( value ) && ! isActive ) {\n\t\t\t// insert link\n\t\t\tconst toInsert = applyFormat(\n\t\t\t\tcreate( { text: linkText } ),\n\t\t\t\tformat,\n\t\t\t\t0,\n\t\t\t\tlinkText.length\n\t\t\t);\n\t\t\tconst newAttributes = insert( value, toInsert );\n\t\t\tonChange( { ...newAttributes, needsSelectionUpdate: true } );\n\t\t} else if ( text !== getTextContent( slice( value ) ) ) {\n\t\t\t// edit text in selected link\n\t\t\tconst toInsert = applyFormat(\n\t\t\t\tcreate( { text } ),\n\t\t\t\tformat,\n\t\t\t\t0,\n\t\t\t\ttext.length\n\t\t\t);\n\t\t\tconst newAttributes = insert(\n\t\t\t\tvalue,\n\t\t\t\ttoInsert,\n\t\t\t\tvalue.start,\n\t\t\t\tvalue.end\n\t\t\t);\n\t\t\tonChange( { ...newAttributes, needsSelectionUpdate: true } );\n\t\t} else {\n\t\t\t// transform selected text into link\n\t\t\tconst newAttributes = applyFormat( value, format );\n\t\t\tonChange( { ...newAttributes, needsSelectionUpdate: true } );\n\t\t}\n\n\t\tif ( ! isValidHref( url ) ) {\n\t\t\tspeak(\n\t\t\t\t__(\n\t\t\t\t\t'Warning: the link has been inserted but may have errors. Please test it.'\n\t\t\t\t),\n\t\t\t\t'assertive'\n\t\t\t);\n\t\t} else if ( isActive ) {\n\t\t\tspeak( __( 'Link edited.' ), 'assertive' );\n\t\t} else {\n\t\t\tspeak( __( 'Link inserted' ), 'assertive' );\n\t\t}\n\n\t\tthis.props.onClose();\n\t}\n\n\tremoveLink() {\n\t\tthis.props.onRemove();\n\t\tthis.props.onClose();\n\t}\n\n\tonDismiss() {\n\t\tif ( this.state.inputValue === '' ) {\n\t\t\tthis.removeLink();\n\t\t} else {\n\t\t\tthis.submitLink();\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { isVisible } = this.props;\n\t\tconst { text } = this.state;\n\n\t\treturn (\n\t\t\t<BottomSheet\n\t\t\t\tisVisible={ isVisible }\n\t\t\t\tonClose={ this.onDismiss }\n\t\t\t\thideHeader\n\t\t\t>\n\t\t\t\t{\n\t\t\t\t\t/* eslint-disable jsx-a11y/no-autofocus */\n\t\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\t\ticon={ link }\n\t\t\t\t\t\tlabel={ __( 'URL' ) }\n\t\t\t\t\t\tvalue={ this.state.inputValue }\n\t\t\t\t\t\tplaceholder={ __( 'Add URL' ) }\n\t\t\t\t\t\tautoCapitalize=\"none\"\n\t\t\t\t\t\tautoCorrect={ false }\n\t\t\t\t\t\tkeyboardType=\"url\"\n\t\t\t\t\t\tonChangeValue={ this.onChangeInputValue }\n\t\t\t\t\t\tonSubmit={ this.onDismiss }\n\t\t\t\t\t\tautoFocus={ Platform.OS === 'ios' }\n\t\t\t\t\t/>\n\t\t\t\t\t/* eslint-enable jsx-a11y/no-autofocus */\n\t\t\t\t}\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\ticon={ textColor }\n\t\t\t\t\tlabel={ __( 'Link text' ) }\n\t\t\t\t\tvalue={ text }\n\t\t\t\t\tplaceholder={ __( 'Add link text' ) }\n\t\t\t\t\tonChangeValue={ this.onChangeText }\n\t\t\t\t\tonSubmit={ this.onDismiss }\n\t\t\t\t/>\n\t\t\t\t<BottomSheet.SwitchCell\n\t\t\t\t\ticon={ external }\n\t\t\t\t\tlabel={ __( 'Open in new tab' ) }\n\t\t\t\t\tvalue={ this.state.opensInNewWindow }\n\t\t\t\t\tonValueChange={ this.onChangeOpensInNewWindow }\n\t\t\t\t\tseparatorType={ 'fullWidth' }\n\t\t\t\t/>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\tlabel={ __( 'Remove link' ) }\n\t\t\t\t\tlabelStyle={ styles.clearLinkButton }\n\t\t\t\t\tseparatorType={ 'none' }\n\t\t\t\t\tonPress={ this.removeLink }\n\t\t\t\t/>\n\t\t\t</BottomSheet>\n\t\t);\n\t}\n}\n\nexport default withSpokenMessages( ModalLinkUI );\n"]}