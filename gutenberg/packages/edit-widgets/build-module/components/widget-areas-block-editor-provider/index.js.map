{"version":3,"sources":["@wordpress/edit-widgets/src/components/widget-areas-block-editor-provider/index.js"],"names":["defaultTo","DropZoneProvider","SlotFillProvider","FocusReturnProvider","uploadMedia","useSelect","useEffect","useMemo","useState","createBlock","BlockEditorProvider","BlockEditorKeyboardShortcuts","KeyboardShortcuts","EMPTY_ARRAY","WidgetAreasBlockEditorProvider","blockEditorSettings","props","select","canUser","getEntityRecords","areas","hasUploadPermissions","blocks","setBlocks","length","map","id","name","settings","mediaUploadBlockEditor","onError","argumentsObject","wpAllowedMimeTypes","allowedMimeTypes","message","mediaUpload","templateLock","newBlocks"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { defaultTo } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tDropZoneProvider,\n\tSlotFillProvider,\n\tFocusReturnProvider,\n} from '@wordpress/components';\nimport { uploadMedia } from '@wordpress/media-utils';\nimport { useSelect } from '@wordpress/data';\nimport { useEffect, useMemo, useState } from '@wordpress/element';\nimport { createBlock } from '@wordpress/blocks';\nimport {\n\tBlockEditorProvider,\n\tBlockEditorKeyboardShortcuts,\n} from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport KeyboardShortcuts from '../keyboard-shortcuts';\n\nconst EMPTY_ARRAY = [];\n\nexport default function WidgetAreasBlockEditorProvider( {\n\tblockEditorSettings,\n\t...props\n} ) {\n\tconst { areas, hasUploadPermissions } = useSelect( ( select ) => {\n\t\tconst { canUser, getEntityRecords } = select( 'core' );\n\t\treturn {\n\t\t\tareas: getEntityRecords( 'root', 'widgetArea' ) || EMPTY_ARRAY,\n\t\t\thasUploadPermissions: defaultTo(\n\t\t\t\tcanUser( 'create', 'media' ),\n\t\t\t\ttrue\n\t\t\t),\n\t\t};\n\t} );\n\tconst [ blocks, setBlocks ] = useState( [] );\n\tuseEffect( () => {\n\t\tif ( ! areas || ! areas.length || blocks.length > 0 ) {\n\t\t\treturn;\n\t\t}\n\t\tsetBlocks(\n\t\t\tareas.map( ( { id, name } ) => {\n\t\t\t\treturn createBlock( 'core/widget-area', {\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t} );\n\t\t\t} )\n\t\t);\n\t}, [ areas, blocks ] );\n\n\tconst settings = useMemo( () => {\n\t\tlet mediaUploadBlockEditor;\n\t\tif ( hasUploadPermissions ) {\n\t\t\tmediaUploadBlockEditor = ( { onError, ...argumentsObject } ) => {\n\t\t\t\tuploadMedia( {\n\t\t\t\t\twpAllowedMimeTypes: blockEditorSettings.allowedMimeTypes,\n\t\t\t\t\tonError: ( { message } ) => onError( message ),\n\t\t\t\t\t...argumentsObject,\n\t\t\t\t} );\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\t...blockEditorSettings,\n\t\t\tmediaUpload: mediaUploadBlockEditor,\n\t\t\ttemplateLock: 'all',\n\t\t};\n\t}, [ blockEditorSettings, hasUploadPermissions ] );\n\n\treturn (\n\t\t<>\n\t\t\t<BlockEditorKeyboardShortcuts.Register />\n\t\t\t<KeyboardShortcuts.Register />\n\t\t\t<SlotFillProvider>\n\t\t\t\t<DropZoneProvider>\n\t\t\t\t\t<FocusReturnProvider>\n\t\t\t\t\t\t<BlockEditorProvider\n\t\t\t\t\t\t\tvalue={ blocks }\n\t\t\t\t\t\t\tonInput={ ( newBlocks ) => setBlocks( newBlocks ) }\n\t\t\t\t\t\t\tonChange={ ( newBlocks ) => setBlocks( newBlocks ) }\n\t\t\t\t\t\t\tsettings={ settings }\n\t\t\t\t\t\t\t{ ...props }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FocusReturnProvider>\n\t\t\t\t</DropZoneProvider>\n\t\t\t</SlotFillProvider>\n\t\t</>\n\t);\n}\n"]}