{"version":3,"sources":["@wordpress/edit-site/src/components/block-editor/index.js"],"names":["useSelect","useMemo","useCallback","uploadMedia","useEntityBlockEditor","BlockEditorProvider","BlockEditorKeyboardShortcuts","__experimentalLinkControl","BlockInspector","WritingFlow","ObserveTyping","BlockList","ButtonBlockerAppender","useEditorContext","NavigateToLink","SidebarInspectorFill","BlockEditor","_settings","settings","setSettings","select","isFeatureActive","_canUserCreateMedia","canUser","canUserCreateMedia","focusMode","hasFixedToolbar","mediaUpload","onError","rest","wpAllowedMimeTypes","allowedMimeTypes","message","templateType","blocks","onInput","onChange","setActivePageAndTemplateId","page","templateId","prevSettings","fillProps"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useMemo, useCallback } from '@wordpress/element';\nimport { uploadMedia } from '@wordpress/media-utils';\nimport { useEntityBlockEditor } from '@wordpress/core-data';\nimport {\n\tBlockEditorProvider,\n\tBlockEditorKeyboardShortcuts,\n\t__experimentalLinkControl,\n\tBlockInspector,\n\tWritingFlow,\n\tObserveTyping,\n\tBlockList,\n\tButtonBlockerAppender,\n} from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { useEditorContext } from '../editor';\nimport NavigateToLink from '../navigate-to-link';\nimport { SidebarInspectorFill } from '../sidebar';\n\nexport default function BlockEditor() {\n\tconst { settings: _settings, setSettings } = useEditorContext();\n\tconst { canUserCreateMedia, focusMode, hasFixedToolbar } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { isFeatureActive } = select( 'core/edit-site' );\n\t\t\tconst _canUserCreateMedia = select( 'core' ).canUser(\n\t\t\t\t'create',\n\t\t\t\t'media'\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tcanUserCreateMedia:\n\t\t\t\t\t_canUserCreateMedia || _canUserCreateMedia !== false,\n\t\t\t\tfocusMode: isFeatureActive( 'focusMode' ),\n\t\t\t\thasFixedToolbar: isFeatureActive( 'fixedToolbar' ),\n\t\t\t};\n\t\t},\n\t\t[]\n\t);\n\n\tconst settings = useMemo( () => {\n\t\tif ( ! canUserCreateMedia ) {\n\t\t\treturn _settings;\n\t\t}\n\t\treturn {\n\t\t\t..._settings,\n\t\t\tfocusMode,\n\t\t\thasFixedToolbar,\n\t\t\tmediaUpload( { onError, ...rest } ) {\n\t\t\t\tuploadMedia( {\n\t\t\t\t\twpAllowedMimeTypes: _settings.allowedMimeTypes,\n\t\t\t\t\tonError: ( { message } ) => onError( message ),\n\t\t\t\t\t...rest,\n\t\t\t\t} );\n\t\t\t},\n\t\t};\n\t}, [ canUserCreateMedia, _settings, focusMode, hasFixedToolbar ] );\n\n\tconst [ blocks, onInput, onChange ] = useEntityBlockEditor(\n\t\t'postType',\n\t\tsettings.templateType\n\t);\n\tconst setActivePageAndTemplateId = useCallback(\n\t\t( { page, templateId } ) =>\n\t\t\tsetSettings( ( prevSettings ) => ( {\n\t\t\t\t...prevSettings,\n\t\t\t\tpage,\n\t\t\t\ttemplateId,\n\t\t\t\ttemplateType: 'wp_template',\n\t\t\t} ) ),\n\t\t[]\n\t);\n\n\treturn (\n\t\t<BlockEditorProvider\n\t\t\tsettings={ settings }\n\t\t\tvalue={ blocks }\n\t\t\tonInput={ onInput }\n\t\t\tonChange={ onChange }\n\t\t\tuseSubRegistry={ false }\n\t\t>\n\t\t\t<BlockEditorKeyboardShortcuts />\n\t\t\t<__experimentalLinkControl.ViewerFill>\n\t\t\t\t{ useCallback(\n\t\t\t\t\t( fillProps ) => (\n\t\t\t\t\t\t<NavigateToLink\n\t\t\t\t\t\t\t{ ...fillProps }\n\t\t\t\t\t\t\tactivePage={ settings.page }\n\t\t\t\t\t\t\tonActivePageAndTemplateIdChange={\n\t\t\t\t\t\t\t\tsetActivePageAndTemplateId\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t),\n\t\t\t\t\t[ settings.page, setActivePageAndTemplateId ]\n\t\t\t\t) }\n\t\t\t</__experimentalLinkControl.ViewerFill>\n\t\t\t<SidebarInspectorFill>\n\t\t\t\t<BlockInspector />\n\t\t\t</SidebarInspectorFill>\n\t\t\t<div className=\"editor-styles-wrapper edit-site-block-editor__editor-styles-wrapper\">\n\t\t\t\t<WritingFlow>\n\t\t\t\t\t<ObserveTyping>\n\t\t\t\t\t\t<BlockList\n\t\t\t\t\t\t\tclassName=\"edit-site-block-editor__block-list\"\n\t\t\t\t\t\t\trenderAppender={ ButtonBlockerAppender }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</ObserveTyping>\n\t\t\t\t</WritingFlow>\n\t\t\t</div>\n\t\t</BlockEditorProvider>\n\t);\n}\n"]}