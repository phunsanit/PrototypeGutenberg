{"version":3,"sources":["@wordpress/edit-site/src/components/add-template/index.js"],"names":["useSelect","useDispatch","useState","useCallback","cleanForSlug","__","Modal","TextControl","Button","AddTemplate","ids","onAddTemplateId","onRequestClose","isOpen","slugs","select","getEntityRecord","reduce","acc","id","template","slug","saveEntityRecord","_setSlug","help","setHelp","setSlug","nextSlug","cleanSlug","add","title","status","loading"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useState, useCallback } from '@wordpress/element';\nimport { cleanForSlug } from '@wordpress/editor';\nimport { __ } from '@wordpress/i18n';\nimport { Modal, TextControl, Button } from '@wordpress/components';\n\nexport default function AddTemplate( {\n\tids,\n\tonAddTemplateId,\n\tonRequestClose,\n\tisOpen,\n} ) {\n\tconst slugs = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEntityRecord } = select( 'core' );\n\t\t\treturn ids.reduce( ( acc, id ) => {\n\t\t\t\tconst template = getEntityRecord(\n\t\t\t\t\t'postType',\n\t\t\t\t\t'wp_template',\n\t\t\t\t\tid\n\t\t\t\t);\n\t\t\t\tacc[ template ? template.slug : 'loading' ] = true;\n\t\t\t\treturn acc;\n\t\t\t}, {} );\n\t\t},\n\t\t[ ids ]\n\t);\n\tconst { saveEntityRecord } = useDispatch( 'core' );\n\n\tconst [ slug, _setSlug ] = useState( '' );\n\tconst [ help, setHelp ] = useState();\n\tconst setSlug = useCallback(\n\t\t( nextSlug ) => {\n\t\t\t_setSlug( nextSlug );\n\t\t\tconst cleanSlug = cleanForSlug( nextSlug );\n\t\t\tsetHelp(\n\t\t\t\tslugs[ cleanSlug ]\n\t\t\t\t\t? __( 'Template already exists, edit it instead.' )\n\t\t\t\t\t: cleanSlug\n\t\t\t);\n\t\t},\n\t\t[ slugs ]\n\t);\n\tconst add = useCallback( async () => {\n\t\t_setSlug( '' );\n\t\tconst cleanSlug = cleanForSlug( slug );\n\n\t\ttry {\n\t\t\tconst template = await saveEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\t'wp_template',\n\t\t\t\t{\n\t\t\t\t\ttitle: cleanSlug,\n\t\t\t\t\tstatus: 'publish',\n\t\t\t\t\tslug: cleanSlug,\n\t\t\t\t}\n\t\t\t);\n\t\t\tonAddTemplateId( template.id );\n\t\t\tonRequestClose();\n\t\t} catch ( err ) {\n\t\t\tsetHelp( __( 'Error adding template.' ) );\n\t\t}\n\t}, [ slug, onRequestClose ] );\n\treturn (\n\t\t! slugs.loading &&\n\t\tisOpen && (\n\t\t\t<Modal\n\t\t\t\ttitle={ __( 'Add Template' ) }\n\t\t\t\tonRequestClose={ onRequestClose }\n\t\t\t>\n\t\t\t\t<TextControl\n\t\t\t\t\tlabel={ __( 'Add Template' ) }\n\t\t\t\t\tplaceholder={ __( 'template-slug' ) }\n\t\t\t\t\tvalue={ slug }\n\t\t\t\t\tonChange={ setSlug }\n\t\t\t\t\thelp={ help }\n\t\t\t\t/>\n\t\t\t\t<Button\n\t\t\t\t\tisPrimary\n\t\t\t\t\tdisabled={ ! slug || slugs[ cleanForSlug( slug ) ] }\n\t\t\t\t\tonClick={ add }\n\t\t\t\t>\n\t\t\t\t\t{ __( 'Add' ) }\n\t\t\t\t</Button>\n\t\t\t</Modal>\n\t\t)\n\t);\n}\n"]}