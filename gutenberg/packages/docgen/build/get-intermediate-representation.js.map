{"version":3,"sources":["@wordpress/docgen/src/get-intermediate-representation.js"],"names":["require","get","getExportEntries","getJSDocFromToken","getDependencyPath","UNDOCUMENTED","NAMESPACE_EXPORT","DEFAULT_EXPORT","hasClassWithName","node","name","type","id","hasFunctionWithName","hasVariableWithName","declarations","some","declaration","properties","property","key","hasNamedExportWithName","hasImportWithName","specifiers","specifier","local","isImportDeclaration","someImportMatchesName","token","matches","forEach","imported","someEntryMatchesName","entry","localName","getJSDocFromDependency","parseDependency","doc","ir","filter","find","getJSDoc","ast","undefined","module","candidates","body","length","exports","path","exportEntries","namedExport","push","description","tags","lineStart","lineEnd","exportName"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nconst { get } = require( 'lodash' );\n\n/**\n * Internal dependencies\n */\nconst getExportEntries = require( './get-export-entries' );\nconst getJSDocFromToken = require( './get-jsdoc-from-token' );\nconst getDependencyPath = require( './get-dependency-path' );\n\nconst UNDOCUMENTED = 'Undocumented declaration.';\nconst NAMESPACE_EXPORT = '*';\nconst DEFAULT_EXPORT = 'default';\n\nconst hasClassWithName = ( node, name ) =>\n\tnode.type === 'ClassDeclaration' && node.id.name === name;\n\nconst hasFunctionWithName = ( node, name ) =>\n\tnode.type === 'FunctionDeclaration' && node.id.name === name;\n\nconst hasVariableWithName = ( node, name ) =>\n\tnode.type === 'VariableDeclaration' &&\n\tnode.declarations.some( ( declaration ) => {\n\t\tif ( declaration.id.type === 'ObjectPattern' ) {\n\t\t\treturn declaration.id.properties.some(\n\t\t\t\t( property ) => property.key.name === name\n\t\t\t);\n\t\t}\n\t\treturn declaration.id.name === name;\n\t} );\n\nconst hasNamedExportWithName = ( node, name ) =>\n\tnode.type === 'ExportNamedDeclaration' &&\n\t( ( node.declaration && hasClassWithName( node.declaration, name ) ) ||\n\t\t( node.declaration && hasFunctionWithName( node.declaration, name ) ) ||\n\t\t( node.declaration && hasVariableWithName( node.declaration, name ) ) );\n\nconst hasImportWithName = ( node, name ) =>\n\tnode.type === 'ImportDeclaration' &&\n\tnode.specifiers.some( ( specifier ) => specifier.local.name === name );\n\nconst isImportDeclaration = ( node ) => node.type === 'ImportDeclaration';\n\nconst someImportMatchesName = ( name, token ) => {\n\tlet matches = false;\n\ttoken.specifiers.forEach( ( specifier ) => {\n\t\tif (\n\t\t\tspecifier.type === 'ImportDefaultSpecifier' &&\n\t\t\tname === 'default'\n\t\t) {\n\t\t\tmatches = true;\n\t\t}\n\t\tif (\n\t\t\tspecifier.type === 'ImportSpecifier' &&\n\t\t\tname === specifier.imported.name\n\t\t) {\n\t\t\tmatches = true;\n\t\t}\n\t} );\n\treturn matches;\n};\n\nconst someEntryMatchesName = ( name, entry, token ) =>\n\t( token.type === 'ExportNamedDeclaration' && entry.localName === name ) ||\n\t( token.type === 'ImportDeclaration' &&\n\t\tsomeImportMatchesName( name, token ) );\n\nconst getJSDocFromDependency = ( token, entry, parseDependency ) => {\n\tlet doc;\n\tconst ir = parseDependency( getDependencyPath( token ) );\n\tif ( entry.localName === NAMESPACE_EXPORT ) {\n\t\tdoc = ir.filter( ( { name } ) => name !== DEFAULT_EXPORT );\n\t} else {\n\t\tdoc = ir.find( ( { name } ) =>\n\t\t\tsomeEntryMatchesName( name, entry, token )\n\t\t);\n\t}\n\treturn doc;\n};\n\nconst getJSDoc = ( token, entry, ast, parseDependency ) => {\n\tlet doc;\n\tif ( entry.localName !== NAMESPACE_EXPORT ) {\n\t\tdoc = getJSDocFromToken( token );\n\t\tif ( doc !== undefined ) {\n\t\t\treturn doc;\n\t\t}\n\t}\n\n\tif ( entry && entry.module === null ) {\n\t\tconst candidates = ast.body.filter( ( node ) => {\n\t\t\treturn (\n\t\t\t\thasClassWithName( node, entry.localName ) ||\n\t\t\t\thasFunctionWithName( node, entry.localName ) ||\n\t\t\t\thasVariableWithName( node, entry.localName ) ||\n\t\t\t\thasNamedExportWithName( node, entry.localName ) ||\n\t\t\t\thasImportWithName( node, entry.localName )\n\t\t\t);\n\t\t} );\n\t\tif ( candidates.length !== 1 ) {\n\t\t\treturn doc;\n\t\t}\n\t\tconst node = candidates[ 0 ];\n\t\tif ( isImportDeclaration( node ) ) {\n\t\t\tdoc = getJSDocFromDependency( node, entry, parseDependency );\n\t\t} else {\n\t\t\tdoc = getJSDocFromToken( node );\n\t\t}\n\t\treturn doc;\n\t}\n\n\treturn getJSDocFromDependency( token, entry, parseDependency );\n};\n\n/**\n * Takes a export token and returns an intermediate representation in JSON.\n *\n * If the export token doesn't contain any JSDoc, and it's a identifier,\n * the identifier declaration will be looked up in the file or dependency\n * if an `ast` and `parseDependency` callback are provided.\n *\n * @param {string} path Path to file being processed.\n * @param {Object} token Espree export token.\n * @param {Object} [ast] Espree ast of the file being parsed.\n * @param {Function} [parseDependency] Function that takes a path\n * and returns the intermediate representation of the dependency file.\n *\n * @return {Object} Intermediate Representation in JSON.\n */\nmodule.exports = function(\n\tpath,\n\ttoken,\n\tast = { body: [] },\n\tparseDependency = () => {}\n) {\n\tconst exportEntries = getExportEntries( token );\n\tconst ir = [];\n\texportEntries.forEach( ( entry ) => {\n\t\tconst doc = getJSDoc( token, entry, ast, parseDependency );\n\t\tif ( entry.localName === NAMESPACE_EXPORT ) {\n\t\t\tdoc.forEach( ( namedExport ) => {\n\t\t\t\tir.push( {\n\t\t\t\t\tpath,\n\t\t\t\t\tname: namedExport.name,\n\t\t\t\t\tdescription: namedExport.description,\n\t\t\t\t\ttags: namedExport.tags,\n\t\t\t\t\tlineStart: entry.lineStart,\n\t\t\t\t\tlineEnd: entry.lineEnd,\n\t\t\t\t} );\n\t\t\t} );\n\t\t} else {\n\t\t\tir.push( {\n\t\t\t\tpath,\n\t\t\t\tname: entry.exportName,\n\t\t\t\tdescription: get( doc, [ 'description' ], UNDOCUMENTED ),\n\t\t\t\ttags: get( doc, [ 'tags' ], [] ),\n\t\t\t\tlineStart: entry.lineStart,\n\t\t\t\tlineEnd: entry.lineEnd,\n\t\t\t} );\n\t\t}\n\t} );\n\treturn ir;\n};\n"]}