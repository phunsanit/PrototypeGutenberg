{"version":3,"sources":["@wordpress/block-editor/src/autocompleters/block.js"],"names":["once","select","createBlock","BlockIcon","defaultGetBlockInsertionParentClientId","getBlockInsertionPoint","rootClientId","defaultGetInserterItems","getInserterItems","defaultGetSelectedBlockName","getSelectedBlockClientId","getBlockName","selectedBlockClientId","fetchReusableBlocks","getSettings","__experimentalFetchReusableBlocks","createBlockCompleter","getBlockInsertionParentClientId","getSelectedBlockName","name","className","triggerPrefix","options","selectedBlockName","filter","inserterItem","getOptionKeywords","title","keywords","category","getOptionLabel","icon","allowContext","before","after","test","getOptionCompletion","initialAttributes","action","value","isOptionDisabled","isDisabled"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { once } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { select } from '@wordpress/data';\nimport { createBlock } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport BlockIcon from '../components/block-icon';\n\n/** @typedef {import('@wordpress/block-editor').WPEditorInserterItem} WPEditorInserterItem */\n\n/** @typedef {import('@wordpress/components').WPCompleter} WPCompleter */\n\n/**\n * Returns the client ID of the parent where a newly inserted block would be\n * placed.\n *\n * @return {string} Client ID of the parent where a newly inserted block would\n *                  be placed.\n */\nfunction defaultGetBlockInsertionParentClientId() {\n\treturn select( 'core/block-editor' ).getBlockInsertionPoint().rootClientId;\n}\n\n/**\n * Returns the inserter items for the specified parent block.\n *\n * @param {string} rootClientId Client ID of the block for which to retrieve\n *                              inserter items.\n *\n * @return {Array<WPEditorInserterItem>} The inserter items for the specified\n *                                      parent.\n */\nfunction defaultGetInserterItems( rootClientId ) {\n\treturn select( 'core/block-editor' ).getInserterItems( rootClientId );\n}\n\n/**\n * Returns the name of the currently selected block.\n *\n * @return {string?} The name of the currently selected block or `null` if no\n *                   block is selected.\n */\nfunction defaultGetSelectedBlockName() {\n\tconst { getSelectedBlockClientId, getBlockName } = select(\n\t\t'core/block-editor'\n\t);\n\tconst selectedBlockClientId = getSelectedBlockClientId();\n\treturn selectedBlockClientId ? getBlockName( selectedBlockClientId ) : null;\n}\n\n/**\n * Triggers a fetch of reusable blocks, once.\n *\n * TODO: Reusable blocks fetching should be reimplemented as a core-data entity\n * resolver, not relying on `core/editor` (see #7119). The implementation here\n * is imperfect in that the options result will not await the completion of the\n * fetch request and thus will not include any reusable blocks. This has always\n * been true, but relied upon the fact the user would be delayed in typing an\n * autocompleter search query. Once implemented using resolvers, the status of\n * this request could be subscribed to as part of a promised return value using\n * the result of `hasFinishedResolution`. There is currently reliable way to\n * determine that a reusable blocks fetch request has completed.\n *\n * @return {Promise} Promise resolving once reusable blocks fetched.\n */\nconst fetchReusableBlocks = once( () => {\n\tconst { __experimentalFetchReusableBlocks } = select(\n\t\t'core/block-editor'\n\t).getSettings();\n\n\tif ( __experimentalFetchReusableBlocks ) {\n\t\t__experimentalFetchReusableBlocks();\n\t}\n} );\n\n/**\n * Creates a blocks repeater for replacing the current block with a selected block type.\n *\n * @return {WPCompleter} A blocks completer.\n */\nexport function createBlockCompleter( {\n\t// Allow store-based selectors to be overridden for unit test.\n\tgetBlockInsertionParentClientId = defaultGetBlockInsertionParentClientId,\n\tgetInserterItems = defaultGetInserterItems,\n\tgetSelectedBlockName = defaultGetSelectedBlockName,\n} = {} ) {\n\treturn {\n\t\tname: 'blocks',\n\t\tclassName: 'block-editor-autocompleters__block',\n\t\ttriggerPrefix: '/',\n\t\toptions() {\n\t\t\tfetchReusableBlocks();\n\n\t\t\tconst selectedBlockName = getSelectedBlockName();\n\t\t\treturn getInserterItems( getBlockInsertionParentClientId() ).filter(\n\t\t\t\t// Avoid offering to replace the current block with a block of the same type.\n\t\t\t\t( inserterItem ) => selectedBlockName !== inserterItem.name\n\t\t\t);\n\t\t},\n\t\tgetOptionKeywords( inserterItem ) {\n\t\t\tconst { title, keywords = [], category } = inserterItem;\n\t\t\treturn [ category, ...keywords, title ];\n\t\t},\n\t\tgetOptionLabel( inserterItem ) {\n\t\t\tconst { icon, title } = inserterItem;\n\t\t\treturn [ <BlockIcon key=\"icon\" icon={ icon } showColors />, title ];\n\t\t},\n\t\tallowContext( before, after ) {\n\t\t\treturn ! ( /\\S/.test( before ) || /\\S/.test( after ) );\n\t\t},\n\t\tgetOptionCompletion( inserterItem ) {\n\t\t\tconst { name, initialAttributes } = inserterItem;\n\t\t\treturn {\n\t\t\t\taction: 'replace',\n\t\t\t\tvalue: createBlock( name, initialAttributes ),\n\t\t\t};\n\t\t},\n\t\tisOptionDisabled( inserterItem ) {\n\t\t\treturn inserterItem.isDisabled;\n\t\t},\n\t};\n}\n\n/**\n * Creates a blocks repeater for replacing the current block with a selected block type.\n *\n * @return {WPCompleter} A blocks completer.\n */\nexport default createBlockCompleter();\n"]}