{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/insertion-point.js"],"names":["classnames","useSelect","useState","useRef","Popover","placeCaretAtVerticalEdge","Inserter","getClosestTabbable","getBlockDOMNode","Indicator","clientId","showInsertionPoint","select","getBlockIndex","getBlockInsertionPoint","isBlockInsertionPointVisible","getBlockRootClientId","rootClientId","blockIndex","insertionPoint","index","InsertionPoint","isMultiSelecting","hasMultiSelection","selectedBlockClientId","children","containerRef","isInserterShown","setIsInserterShown","isInserterForced","setIsInserterForced","inserterElement","setInserterElement","inserterClientId","setInserterClientId","ref","getMultiSelectedBlockClientIds","multiSelectedBlockClientIds","onMouseMove","event","target","classList","contains","rect","getBoundingClientRect","offset","clientY","top","element","Array","from","find","blockEl","offsetTop","id","slice","length","elementRect","clientX","right","left","focusClosestTabbable","current","targetRect","isReverse","height","blockNode","container","closest","window","DOMRect","isInserterHidden","includes","width","offsetWidth","undefined"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useState, useRef } from '@wordpress/element';\nimport { Popover } from '@wordpress/components';\nimport { placeCaretAtVerticalEdge } from '@wordpress/dom';\n\n/**\n * Internal dependencies\n */\nimport Inserter from '../inserter';\nimport { getClosestTabbable } from '../writing-flow';\nimport { getBlockDOMNode } from '../../utils/dom';\n\nfunction Indicator( { clientId } ) {\n\tconst showInsertionPoint = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlockIndex,\n\t\t\t\tgetBlockInsertionPoint,\n\t\t\t\tisBlockInsertionPointVisible,\n\t\t\t\tgetBlockRootClientId,\n\t\t\t} = select( 'core/block-editor' );\n\t\t\tconst rootClientId = getBlockRootClientId( clientId );\n\t\t\tconst blockIndex = getBlockIndex( clientId, rootClientId );\n\t\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\t\treturn (\n\t\t\t\tisBlockInsertionPointVisible() &&\n\t\t\t\tinsertionPoint.index === blockIndex &&\n\t\t\t\tinsertionPoint.rootClientId === rootClientId\n\t\t\t);\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tif ( ! showInsertionPoint ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div className=\"block-editor-block-list__insertion-point-indicator\" />\n\t);\n}\n\nexport default function InsertionPoint( {\n\tisMultiSelecting,\n\thasMultiSelection,\n\tselectedBlockClientId,\n\tchildren,\n\tcontainerRef,\n} ) {\n\tconst [ isInserterShown, setIsInserterShown ] = useState( false );\n\tconst [ isInserterForced, setIsInserterForced ] = useState( false );\n\tconst [ inserterElement, setInserterElement ] = useState( null );\n\tconst [ inserterClientId, setInserterClientId ] = useState( null );\n\tconst ref = useRef();\n\tconst { multiSelectedBlockClientIds } = useSelect( ( select ) => {\n\t\tconst { getMultiSelectedBlockClientIds } = select(\n\t\t\t'core/block-editor'\n\t\t);\n\n\t\treturn {\n\t\t\tmultiSelectedBlockClientIds: getMultiSelectedBlockClientIds(),\n\t\t};\n\t} );\n\n\tfunction onMouseMove( event ) {\n\t\tif (\n\t\t\t! event.target.classList.contains(\n\t\t\t\t'block-editor-block-list__layout'\n\t\t\t)\n\t\t) {\n\t\t\tif ( isInserterShown ) {\n\t\t\t\tsetIsInserterShown( false );\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst rect = event.target.getBoundingClientRect();\n\t\tconst offset = event.clientY - rect.top;\n\t\tconst element = Array.from( event.target.children ).find(\n\t\t\t( blockEl ) => {\n\t\t\t\treturn blockEl.offsetTop > offset;\n\t\t\t}\n\t\t);\n\n\t\tif ( ! element ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst clientId = element.id.slice( 'block-'.length );\n\n\t\tif ( ! clientId ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst elementRect = element.getBoundingClientRect();\n\n\t\tif (\n\t\t\tevent.clientX > elementRect.right ||\n\t\t\tevent.clientX < elementRect.left\n\t\t) {\n\t\t\tif ( isInserterShown ) {\n\t\t\t\tsetIsInserterShown( false );\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsInserterShown( true );\n\t\tsetInserterElement( element );\n\t\tsetInserterClientId( clientId );\n\t}\n\n\tfunction focusClosestTabbable( event ) {\n\t\tconst { clientX, clientY, target } = event;\n\n\t\t// Only handle click on the wrapper specifically, and not an event\n\t\t// bubbled from the inserter itself.\n\t\tif ( target !== ref.current ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetRect = target.getBoundingClientRect();\n\t\tconst isReverse = clientY < targetRect.top + targetRect.height / 2;\n\t\tconst blockNode = getBlockDOMNode( inserterClientId );\n\t\tconst container = isReverse ? containerRef.current : blockNode;\n\t\tconst closest =\n\t\t\tgetClosestTabbable( blockNode, true, container ) || blockNode;\n\t\tconst rect = new window.DOMRect( clientX, clientY, 0, 16 );\n\n\t\tplaceCaretAtVerticalEdge( closest, isReverse, rect, false );\n\t}\n\n\t// Hide the inserter above the selected block and during multi-selection.\n\tconst isInserterHidden = hasMultiSelection\n\t\t? multiSelectedBlockClientIds.includes( inserterClientId )\n\t\t: inserterClientId === selectedBlockClientId;\n\n\treturn (\n\t\t<>\n\t\t\t{ ! isMultiSelecting && ( isInserterShown || isInserterForced ) && (\n\t\t\t\t<Popover\n\t\t\t\t\tnoArrow\n\t\t\t\t\tanimate={ false }\n\t\t\t\t\tanchorRef={ inserterElement }\n\t\t\t\t\tposition=\"top right left\"\n\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\tclassName=\"block-editor-block-list__insertion-point-popover\"\n\t\t\t\t\t__unstableSlotName=\"block-toolbar\"\n\t\t\t\t\t__unstableFixedPosition={ false }\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"block-editor-block-list__insertion-point\"\n\t\t\t\t\t\tstyle={ { width: inserterElement.offsetWidth } }\n\t\t\t\t\t>\n\t\t\t\t\t\t<Indicator clientId={ inserterClientId } />\n\t\t\t\t\t\t{ /* eslint-disable-next-line jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */ }\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\t\tonFocus={ () => setIsInserterForced( true ) }\n\t\t\t\t\t\t\tonBlur={ () => setIsInserterForced( false ) }\n\t\t\t\t\t\t\tonClick={ focusClosestTabbable }\n\t\t\t\t\t\t\t// While ideally it would be enough to capture the\n\t\t\t\t\t\t\t// bubbling focus event from the Inserter, due to the\n\t\t\t\t\t\t\t// characteristics of click focusing of `button`s in\n\t\t\t\t\t\t\t// Firefox and Safari, it is not reliable.\n\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t// See: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\t\t\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t'block-editor-block-list__insertion-point-inserter',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t'is-inserter-hidden': isInserterHidden,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Inserter\n\t\t\t\t\t\t\t\tposition=\"bottom center\"\n\t\t\t\t\t\t\t\tclientId={ inserterClientId }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t\t<div\n\t\t\t\tonMouseMove={\n\t\t\t\t\t! isInserterForced && ! isMultiSelecting\n\t\t\t\t\t\t? onMouseMove\n\t\t\t\t\t\t: undefined\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</div>\n\t\t</>\n\t);\n}\n"]}