{"version":3,"sources":["@wordpress/block-editor/src/components/block-compare/index.js"],"names":["classnames","castArray","diffChars","__","Component","getSaveContent","getSaveElement","BlockView","BlockCompare","originalContent","newContent","difference","map","item","pos","classes","added","removed","value","block","rawContent","renderedContent","name","attributes","newBlocks","innerBlocks","join","props","onKeep","onConvert","convertor","convertButtonText","original","getOriginalContent","converted","getConvertedContent","getDifference"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { castArray } from 'lodash';\n// diff doesn't tree-shake correctly, so we import from the individual\n// module here, to avoid including too much of the library\nimport { diffChars } from 'diff/lib/diff/character';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { getSaveContent, getSaveElement } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport BlockView from './block-view';\n\nclass BlockCompare extends Component {\n\tgetDifference( originalContent, newContent ) {\n\t\tconst difference = diffChars( originalContent, newContent );\n\n\t\treturn difference.map( ( item, pos ) => {\n\t\t\tconst classes = classnames( {\n\t\t\t\t'block-editor-block-compare__added': item.added,\n\t\t\t\t'block-editor-block-compare__removed': item.removed,\n\t\t\t} );\n\n\t\t\treturn (\n\t\t\t\t<span key={ pos } className={ classes }>\n\t\t\t\t\t{ item.value }\n\t\t\t\t</span>\n\t\t\t);\n\t\t} );\n\t}\n\n\tgetOriginalContent( block ) {\n\t\treturn {\n\t\t\trawContent: block.originalContent,\n\t\t\trenderedContent: getSaveElement( block.name, block.attributes ),\n\t\t};\n\t}\n\n\tgetConvertedContent( block ) {\n\t\t// The convertor may return an array of items or a single item\n\t\tconst newBlocks = castArray( block );\n\n\t\t// Get converted block details\n\t\tconst newContent = newBlocks.map( ( item ) =>\n\t\t\tgetSaveContent( item.name, item.attributes, item.innerBlocks )\n\t\t);\n\t\tconst renderedContent = newBlocks.map( ( item ) =>\n\t\t\tgetSaveElement( item.name, item.attributes, item.innerBlocks )\n\t\t);\n\n\t\treturn {\n\t\t\trawContent: newContent.join( '' ),\n\t\t\trenderedContent,\n\t\t};\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tblock,\n\t\t\tonKeep,\n\t\t\tonConvert,\n\t\t\tconvertor,\n\t\t\tconvertButtonText,\n\t\t} = this.props;\n\t\tconst original = this.getOriginalContent( block );\n\t\tconst converted = this.getConvertedContent( convertor( block ) );\n\t\tconst difference = this.getDifference(\n\t\t\toriginal.rawContent,\n\t\t\tconverted.rawContent\n\t\t);\n\n\t\treturn (\n\t\t\t<div className=\"block-editor-block-compare__wrapper\">\n\t\t\t\t<BlockView\n\t\t\t\t\ttitle={ __( 'Current' ) }\n\t\t\t\t\tclassName=\"block-editor-block-compare__current\"\n\t\t\t\t\taction={ onKeep }\n\t\t\t\t\tactionText={ __( 'Convert to HTML' ) }\n\t\t\t\t\trawContent={ original.rawContent }\n\t\t\t\t\trenderedContent={ original.renderedContent }\n\t\t\t\t/>\n\n\t\t\t\t<BlockView\n\t\t\t\t\ttitle={ __( 'After Conversion' ) }\n\t\t\t\t\tclassName=\"block-editor-block-compare__converted\"\n\t\t\t\t\taction={ onConvert }\n\t\t\t\t\tactionText={ convertButtonText }\n\t\t\t\t\trawContent={ difference }\n\t\t\t\t\trenderedContent={ converted.renderedContent }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default BlockCompare;\n"]}