{"version":3,"sources":["@wordpress/block-editor/src/components/use-moving-animation/index.js"],"names":["useSpring","interpolate","useState","useLayoutEffect","useReducer","useRef","useReducedMotion","getScrollContainer","counterReducer","state","getAbsolutePosition","element","top","offsetTop","left","offsetLeft","useMovingAnimation","ref","isSelected","adjustScrolling","enableAnimation","triggerAnimationOnChange","prefersReducedMotion","triggeredAnimation","triggerAnimation","finishedAnimation","endAnimation","x","y","scrollTop","transform","setTransform","previous","current","scrollContainer","style","destination","newTransform","undefined","animationProps","from","to","reset","config","mass","tension","friction","immediate","onFrame","props","transformOrigin","zIndex"],"mappings":";;AAAA;;;AAGA,SAASA,SAAT,EAAoBC,WAApB,QAAuC,sBAAvC;AAEA;;;;AAGA,SACCC,QADD,EAECC,eAFD,EAGCC,UAHD,EAICC,MAJD,QAKO,oBALP;AAMA,SAASC,gBAAT,QAAiC,oBAAjC;AACA,SAASC,kBAAT,QAAmC,gBAAnC;AAEA;;;;;;;AAMA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAAEC,KAAF;AAAA,SAAaA,KAAK,GAAG,CAArB;AAAA,CAAvB;;AAEA,IAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAEC,OAAF,EAAe;AAC1C,SAAO;AACNC,IAAAA,GAAG,EAAED,OAAO,CAACE,SADP;AAENC,IAAAA,IAAI,EAAEH,OAAO,CAACI;AAFR,GAAP;AAIA,CALD;AAOA;;;;;;;;;;;;;;;;;;;;;AAmBA,SAASC,kBAAT,CACCC,GADD,EAECC,UAFD,EAGCC,eAHD,EAICC,eAJD,EAKCC,wBALD,EAME;AACD,MAAMC,oBAAoB,GAAGhB,gBAAgB,MAAM,CAAEc,eAArD;;AADC,oBAEgDhB,UAAU,CAC1DI,cAD0D,EAE1D,CAF0D,CAF1D;AAAA;AAAA,MAEOe,kBAFP;AAAA,MAE2BC,gBAF3B;;AAAA,qBAM2CpB,UAAU,CAAEI,cAAF,EAAkB,CAAlB,CANrD;AAAA;AAAA,MAMOiB,iBANP;AAAA,MAM0BC,YAN1B;;AAAA,kBAOmCxB,QAAQ,CAAE;AAC7CyB,IAAAA,CAAC,EAAE,CAD0C;AAE7CC,IAAAA,CAAC,EAAE,CAF0C;AAG7CC,IAAAA,SAAS,EAAE;AAHkC,GAAF,CAP3C;AAAA;AAAA,MAOOC,SAPP;AAAA,MAOkBC,YAPlB;;AAaD,MAAMC,QAAQ,GAAGf,GAAG,CAACgB,OAAJ,GAAcvB,mBAAmB,CAAEO,GAAG,CAACgB,OAAN,CAAjC,GAAmD,IAApE;AACA,MAAMC,eAAe,GAAG7B,MAAM,EAA9B;AAEAF,EAAAA,eAAe,CAAE,YAAM;AACtB,QAAKoB,kBAAL,EAA0B;AACzBG,MAAAA,YAAY;AACZ;AACD,GAJc,EAIZ,CAAEH,kBAAF,CAJY,CAAf;AAKApB,EAAAA,eAAe,CAAE,YAAM;AACtB,QAAK,CAAE6B,QAAP,EAAkB;AACjB;AACA;;AAEDE,IAAAA,eAAe,CAACD,OAAhB,GAA0B1B,kBAAkB,CAAEU,GAAG,CAACgB,OAAN,CAA5C;;AACA,QAAKX,oBAAL,EAA4B;AAC3B,UAAKH,eAAe,IAAIe,eAAe,CAACD,OAAxC,EAAkD;AACjD;AACA;AACAhB,QAAAA,GAAG,CAACgB,OAAJ,CAAYE,KAAZ,CAAkBL,SAAlB,GAA8B,MAA9B;;AACA,YAAMM,YAAW,GAAG1B,mBAAmB,CAAEO,GAAG,CAACgB,OAAN,CAAvC;;AACAC,QAAAA,eAAe,CAACD,OAAhB,CAAwBJ,SAAxB,GACCK,eAAe,CAACD,OAAhB,CAAwBJ,SAAxB,GACAG,QAAQ,CAACpB,GADT,GAEAwB,YAAW,CAACxB,GAHb;AAIA;;AAED;AACA;;AACDK,IAAAA,GAAG,CAACgB,OAAJ,CAAYE,KAAZ,CAAkBL,SAAlB,GAA8B,MAA9B;AACA,QAAMM,WAAW,GAAG1B,mBAAmB,CAAEO,GAAG,CAACgB,OAAN,CAAvC;AACA,QAAMI,YAAY,GAAG;AACpBV,MAAAA,CAAC,EAAEK,QAAQ,CAAClB,IAAT,GAAgBsB,WAAW,CAACtB,IADX;AAEpBc,MAAAA,CAAC,EAAEI,QAAQ,CAACpB,GAAT,GAAewB,WAAW,CAACxB,GAFV;AAGpBiB,MAAAA,SAAS,EAAEK,eAAe,CAACD,OAAhB,GACRC,eAAe,CAACD,OAAhB,CAAwBJ,SAAxB,GACAG,QAAQ,CAACpB,GADT,GAEAwB,WAAW,CAACxB,GAHJ,GAIR;AAPiB,KAArB;AASAK,IAAAA,GAAG,CAACgB,OAAJ,CAAYE,KAAZ,CAAkBL,SAAlB,GACCO,YAAY,CAACV,CAAb,KAAmB,CAAnB,IAAwBU,YAAY,CAACT,CAAb,KAAmB,CAA3C,GACGU,SADH,yBAEmBD,YAAY,CAACV,CAFhC,gBAEyCU,YAAY,CAACT,CAFtD,UADD;AAIAJ,IAAAA,gBAAgB;AAChBO,IAAAA,YAAY,CAAEM,YAAF,CAAZ;AACA,GArCc,EAqCZ,CAAEhB,wBAAF,CArCY,CAAf;AAuCA,MAAMkB,cAAc,GAAGvC,SAAS,CAAE;AACjCwC,IAAAA,IAAI,EAAE;AACLb,MAAAA,CAAC,EAAEG,SAAS,CAACH,CADR;AAELC,MAAAA,CAAC,EAAEE,SAAS,CAACF;AAFR,KAD2B;AAKjCa,IAAAA,EAAE,EAAE;AACHd,MAAAA,CAAC,EAAE,CADA;AAEHC,MAAAA,CAAC,EAAE;AAFA,KAL6B;AASjCc,IAAAA,KAAK,EAAEnB,kBAAkB,KAAKE,iBATG;AAUjCkB,IAAAA,MAAM,EAAE;AAAEC,MAAAA,IAAI,EAAE,CAAR;AAAWC,MAAAA,OAAO,EAAE,IAApB;AAA0BC,MAAAA,QAAQ,EAAE;AAApC,KAVyB;AAWjCC,IAAAA,SAAS,EAAEzB,oBAXsB;AAYjC0B,IAAAA,OAAO,EAAE,iBAAEC,KAAF,EAAa;AACrB,UACC9B,eAAe,IACfe,eAAe,CAACD,OADhB,IAEA,CAAEX,oBAFF,IAGA2B,KAAK,CAACrB,CAJP,EAKE;AACDM,QAAAA,eAAe,CAACD,OAAhB,CAAwBJ,SAAxB,GACCC,SAAS,CAACD,SAAV,GAAsBoB,KAAK,CAACrB,CAD7B;AAEA;AACD;AAtBgC,GAAF,CAAhC,CA5DC,CAqFD;;AACA,SAAON,oBAAoB,GACxB,EADwB,GAExB;AACA4B,IAAAA,eAAe,EAAE,QADjB;AAEApB,IAAAA,SAAS,EAAE7B,WAAW,CACrB,CAAEsC,cAAc,CAACZ,CAAjB,EAAoBY,cAAc,CAACX,CAAnC,CADqB,EAErB,UAAED,CAAF,EAAKC,CAAL;AAAA,aACCD,CAAC,KAAK,CAAN,IAAWC,CAAC,KAAK,CAAjB,GACGU,SADH,yBAEmBX,CAFnB,gBAE4BC,CAF5B,UADD;AAAA,KAFqB,CAFtB;AASAuB,IAAAA,MAAM,EAAElD,WAAW,CAClB,CAAEsC,cAAc,CAACZ,CAAjB,EAAoBY,cAAc,CAACX,CAAnC,CADkB,EAElB,UAAED,CAAF,EAAKC,CAAL;AAAA,aACC,CAAEV,UAAF,IAAkBS,CAAC,KAAK,CAAN,IAAWC,CAAC,KAAK,CAAnC,GAAyCU,SAAzC,MADD;AAAA,KAFkB;AATnB,GAFH;AAiBA;;AAED,eAAetB,kBAAf","sourcesContent":["/**\n * External dependencies\n */\nimport { useSpring, interpolate } from 'react-spring/web.cjs';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tuseState,\n\tuseLayoutEffect,\n\tuseReducer,\n\tuseRef,\n} from '@wordpress/element';\nimport { useReducedMotion } from '@wordpress/compose';\nimport { getScrollContainer } from '@wordpress/dom';\n\n/**\n * Simple reducer used to increment a counter.\n *\n * @param {number} state  Previous counter value.\n * @return {number} New state value.\n */\nconst counterReducer = ( state ) => state + 1;\n\nconst getAbsolutePosition = ( element ) => {\n\treturn {\n\t\ttop: element.offsetTop,\n\t\tleft: element.offsetLeft,\n\t};\n};\n\n/**\n * Hook used to compute the styles required to move a div into a new position.\n *\n * The way this animation works is the following:\n *  - It first renders the element as if there was no animation.\n *  - It takes a snapshot of the position of the block to use it\n *    as a destination point for the animation.\n *  - It restores the element to the previous position using a CSS transform\n *  - It uses the \"resetAnimation\" flag to reset the animation\n *    from the beginning in order to animate to the new destination point.\n *\n * @param {Object}  ref                      Reference to the element to animate.\n * @param {boolean} isSelected               Whether it's the current block or not.\n * @param {boolean} adjustScrolling          Adjust the scroll position to the current block.\n * @param {boolean} enableAnimation          Enable/Disable animation.\n * @param {*}       triggerAnimationOnChange Variable used to trigger the animation if it changes.\n *\n * @return {Object} Style object.\n */\nfunction useMovingAnimation(\n\tref,\n\tisSelected,\n\tadjustScrolling,\n\tenableAnimation,\n\ttriggerAnimationOnChange\n) {\n\tconst prefersReducedMotion = useReducedMotion() || ! enableAnimation;\n\tconst [ triggeredAnimation, triggerAnimation ] = useReducer(\n\t\tcounterReducer,\n\t\t0\n\t);\n\tconst [ finishedAnimation, endAnimation ] = useReducer( counterReducer, 0 );\n\tconst [ transform, setTransform ] = useState( {\n\t\tx: 0,\n\t\ty: 0,\n\t\tscrollTop: 0,\n\t} );\n\n\tconst previous = ref.current ? getAbsolutePosition( ref.current ) : null;\n\tconst scrollContainer = useRef();\n\n\tuseLayoutEffect( () => {\n\t\tif ( triggeredAnimation ) {\n\t\t\tendAnimation();\n\t\t}\n\t}, [ triggeredAnimation ] );\n\tuseLayoutEffect( () => {\n\t\tif ( ! previous ) {\n\t\t\treturn;\n\t\t}\n\n\t\tscrollContainer.current = getScrollContainer( ref.current );\n\t\tif ( prefersReducedMotion ) {\n\t\t\tif ( adjustScrolling && scrollContainer.current ) {\n\t\t\t\t// if the animation is disabled and the scroll needs to be adjusted,\n\t\t\t\t// just move directly to the final scroll position\n\t\t\t\tref.current.style.transform = 'none';\n\t\t\t\tconst destination = getAbsolutePosition( ref.current );\n\t\t\t\tscrollContainer.current.scrollTop =\n\t\t\t\t\tscrollContainer.current.scrollTop -\n\t\t\t\t\tprevious.top +\n\t\t\t\t\tdestination.top;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\tref.current.style.transform = 'none';\n\t\tconst destination = getAbsolutePosition( ref.current );\n\t\tconst newTransform = {\n\t\t\tx: previous.left - destination.left,\n\t\t\ty: previous.top - destination.top,\n\t\t\tscrollTop: scrollContainer.current\n\t\t\t\t? scrollContainer.current.scrollTop -\n\t\t\t\t  previous.top +\n\t\t\t\t  destination.top\n\t\t\t\t: 0,\n\t\t};\n\t\tref.current.style.transform =\n\t\t\tnewTransform.x === 0 && newTransform.y === 0\n\t\t\t\t? undefined\n\t\t\t\t: `translate3d(${ newTransform.x }px,${ newTransform.y }px,0)`;\n\t\ttriggerAnimation();\n\t\tsetTransform( newTransform );\n\t}, [ triggerAnimationOnChange ] );\n\n\tconst animationProps = useSpring( {\n\t\tfrom: {\n\t\t\tx: transform.x,\n\t\t\ty: transform.y,\n\t\t},\n\t\tto: {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t},\n\t\treset: triggeredAnimation !== finishedAnimation,\n\t\tconfig: { mass: 5, tension: 2000, friction: 200 },\n\t\timmediate: prefersReducedMotion,\n\t\tonFrame: ( props ) => {\n\t\t\tif (\n\t\t\t\tadjustScrolling &&\n\t\t\t\tscrollContainer.current &&\n\t\t\t\t! prefersReducedMotion &&\n\t\t\t\tprops.y\n\t\t\t) {\n\t\t\t\tscrollContainer.current.scrollTop =\n\t\t\t\t\ttransform.scrollTop + props.y;\n\t\t\t}\n\t\t},\n\t} );\n\n\t// Dismiss animations if disabled.\n\treturn prefersReducedMotion\n\t\t? {}\n\t\t: {\n\t\t\t\ttransformOrigin: 'center',\n\t\t\t\ttransform: interpolate(\n\t\t\t\t\t[ animationProps.x, animationProps.y ],\n\t\t\t\t\t( x, y ) =>\n\t\t\t\t\t\tx === 0 && y === 0\n\t\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t\t: `translate3d(${ x }px,${ y }px,0)`\n\t\t\t\t),\n\t\t\t\tzIndex: interpolate(\n\t\t\t\t\t[ animationProps.x, animationProps.y ],\n\t\t\t\t\t( x, y ) =>\n\t\t\t\t\t\t! isSelected || ( x === 0 && y === 0 ) ? undefined : `1`\n\t\t\t\t),\n\t\t  };\n}\n\nexport default useMovingAnimation;\n"]}