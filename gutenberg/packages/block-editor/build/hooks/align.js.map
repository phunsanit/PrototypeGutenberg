{"version":3,"sources":["@wordpress/block-editor/src/hooks/align.js"],"names":["ALL_ALIGNMENTS","WIDE_ALIGNMENTS","getValidAlignments","blockAlign","hasWideBlockSupport","hasWideEnabled","validAlignments","Array","isArray","without","addAttribute","settings","attributes","align","type","AlignmentHookSettings","AlignmentHookSettingsProvider","Provider","withToolbarControls","BlockEdit","props","isEmbedButton","blockName","name","updateAlignment","nextAlign","blockType","blockDefaultAlign","setAttributes","length","isSelected","withDataAlign","BlockListBlock","select","getSettings","alignWide","undefined","wrapperProps","addAssignedAlign","isAlignValid","className"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { get, has, includes, without } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { createContext, useContext } from '@wordpress/element';\nimport { createHigherOrderComponent } from '@wordpress/compose';\nimport { addFilter } from '@wordpress/hooks';\nimport {\n\tgetBlockSupport,\n\tgetBlockType,\n\thasBlockSupport,\n} from '@wordpress/blocks';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { BlockControls, BlockAlignmentToolbar } from '../components';\n\n/**\n * An array which includes all possible valid alignments,\n * used to validate if an alignment is valid or not.\n *\n * @constant\n * @type {string[]}\n */\nconst ALL_ALIGNMENTS = [ 'left', 'center', 'right', 'wide', 'full' ];\n\n/**\n * An array which includes all wide alignments.\n * In order for this alignments to be valid they need to be supported by the block,\n * and by the theme.\n *\n * @constant\n * @type {string[]}\n */\nconst WIDE_ALIGNMENTS = [ 'wide', 'full' ];\n\n/**\n * Returns the valid alignments.\n * Takes into consideration the aligns supported by a block, if the block supports wide controls or not and if theme supports wide controls or not.\n * Exported just for testing purposes, not exported outside the module.\n *\n * @param {?boolean|string[]} blockAlign          Aligns supported by the block.\n * @param {?boolean}          hasWideBlockSupport True if block supports wide alignments. And False otherwise.\n * @param {?boolean}          hasWideEnabled      True if theme supports wide alignments. And False otherwise.\n *\n * @return {string[]} Valid alignments.\n */\nexport function getValidAlignments(\n\tblockAlign,\n\thasWideBlockSupport = true,\n\thasWideEnabled = true\n) {\n\tlet validAlignments;\n\tif ( Array.isArray( blockAlign ) ) {\n\t\tvalidAlignments = blockAlign;\n\t} else if ( blockAlign === true ) {\n\t\t// `true` includes all alignments...\n\t\tvalidAlignments = ALL_ALIGNMENTS;\n\t} else {\n\t\tvalidAlignments = [];\n\t}\n\n\tif (\n\t\t! hasWideEnabled ||\n\t\t( blockAlign === true && ! hasWideBlockSupport )\n\t) {\n\t\treturn without( validAlignments, ...WIDE_ALIGNMENTS );\n\t}\n\n\treturn validAlignments;\n}\n\n/**\n * Filters registered block settings, extending attributes to include `align`.\n *\n * @param  {Object} settings Original block settings\n * @return {Object}          Filtered block settings\n */\nexport function addAttribute( settings ) {\n\t// allow blocks to specify their own attribute definition with default values if needed.\n\tif ( has( settings.attributes, [ 'align', 'type' ] ) ) {\n\t\treturn settings;\n\t}\n\tif ( hasBlockSupport( settings, 'align' ) ) {\n\t\t// Gracefully handle if settings.attributes is undefined.\n\t\tsettings.attributes = {\n\t\t\t...settings.attributes,\n\t\t\talign: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t};\n\t}\n\n\treturn settings;\n}\n\nconst AlignmentHookSettings = createContext( {} );\n\n/**\n * Allows to pass additional settings to the alignment hook.\n */\nexport const AlignmentHookSettingsProvider = AlignmentHookSettings.Provider;\n\n/**\n * Override the default edit UI to include new toolbar controls for block\n * alignment, if block defines support.\n *\n * @param  {Function} BlockEdit Original component\n * @return {Function}           Wrapped component\n */\nexport const withToolbarControls = createHigherOrderComponent(\n\t( BlockEdit ) => ( props ) => {\n\t\tconst { isEmbedButton } = useContext( AlignmentHookSettings );\n\t\tconst { name: blockName } = props;\n\t\t// Compute valid alignments without taking into account,\n\t\t// if the theme supports wide alignments or not.\n\t\t// BlockAlignmentToolbar takes into account the theme support.\n\t\tconst validAlignments = isEmbedButton\n\t\t\t? []\n\t\t\t: getValidAlignments(\n\t\t\t\t\tgetBlockSupport( blockName, 'align' ),\n\t\t\t\t\thasBlockSupport( blockName, 'alignWide', true )\n\t\t\t  );\n\n\t\tconst updateAlignment = ( nextAlign ) => {\n\t\t\tif ( ! nextAlign ) {\n\t\t\t\tconst blockType = getBlockType( props.name );\n\t\t\t\tconst blockDefaultAlign = get( blockType, [\n\t\t\t\t\t'attributes',\n\t\t\t\t\t'align',\n\t\t\t\t\t'default',\n\t\t\t\t] );\n\t\t\t\tif ( blockDefaultAlign ) {\n\t\t\t\t\tnextAlign = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\tprops.setAttributes( { align: nextAlign } );\n\t\t};\n\n\t\treturn [\n\t\t\tvalidAlignments.length > 0 && props.isSelected && (\n\t\t\t\t<BlockControls key=\"align-controls\">\n\t\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\t\tvalue={ props.attributes.align }\n\t\t\t\t\t\tonChange={ updateAlignment }\n\t\t\t\t\t\tcontrols={ validAlignments }\n\t\t\t\t\t/>\n\t\t\t\t</BlockControls>\n\t\t\t),\n\t\t\t<BlockEdit key=\"edit\" { ...props } />,\n\t\t];\n\t},\n\t'withToolbarControls'\n);\n\n/**\n * Override the default block element to add alignment wrapper props.\n *\n * @param  {Function} BlockListBlock Original component\n * @return {Function}                Wrapped component\n */\nexport const withDataAlign = createHigherOrderComponent(\n\t( BlockListBlock ) => ( props ) => {\n\t\tconst { name, attributes } = props;\n\t\tconst { align } = attributes;\n\t\tconst hasWideEnabled = useSelect(\n\t\t\t( select ) =>\n\t\t\t\t!! select( 'core/block-editor' ).getSettings().alignWide,\n\t\t\t[]\n\t\t);\n\n\t\t// If an alignment is not assigned, there's no need to go through the\n\t\t// effort to validate or assign its value.\n\t\tif ( align === undefined ) {\n\t\t\treturn <BlockListBlock { ...props } />;\n\t\t}\n\n\t\tconst validAlignments = getValidAlignments(\n\t\t\tgetBlockSupport( name, 'align' ),\n\t\t\thasBlockSupport( name, 'alignWide', true ),\n\t\t\thasWideEnabled\n\t\t);\n\n\t\tlet wrapperProps = props.wrapperProps;\n\t\tif ( includes( validAlignments, align ) ) {\n\t\t\twrapperProps = { ...wrapperProps, 'data-align': align };\n\t\t}\n\n\t\treturn <BlockListBlock { ...props } wrapperProps={ wrapperProps } />;\n\t}\n);\n\n/**\n * Override props assigned to save component to inject alignment class name if\n * block supports it.\n *\n * @param  {Object} props      Additional props applied to save element\n * @param  {Object} blockType  Block type\n * @param  {Object} attributes Block attributes\n * @return {Object}            Filtered props applied to save element\n */\nexport function addAssignedAlign( props, blockType, attributes ) {\n\tconst { align } = attributes;\n\tconst blockAlign = getBlockSupport( blockType, 'align' );\n\tconst hasWideBlockSupport = hasBlockSupport( blockType, 'alignWide', true );\n\tconst isAlignValid = includes(\n\t\t// Compute valid alignments without taking into account,\n\t\t// if the theme supports wide alignments or not.\n\t\t// This way changing themes does not impacts the block save.\n\t\tgetValidAlignments( blockAlign, hasWideBlockSupport ),\n\t\talign\n\t);\n\tif ( isAlignValid ) {\n\t\tprops.className = classnames( `align${ align }`, props.className );\n\t}\n\n\treturn props;\n}\n\naddFilter(\n\t'blocks.registerBlockType',\n\t'core/align/addAttribute',\n\taddAttribute\n);\naddFilter(\n\t'editor.BlockListBlock',\n\t'core/editor/align/with-data-align',\n\twithDataAlign\n);\naddFilter(\n\t'editor.BlockEdit',\n\t'core/editor/align/with-toolbar-controls',\n\twithToolbarControls\n);\naddFilter(\n\t'blocks.getSaveContent.extraProps',\n\t'core/align/addAssignedAlign',\n\taddAssignedAlign\n);\n"]}