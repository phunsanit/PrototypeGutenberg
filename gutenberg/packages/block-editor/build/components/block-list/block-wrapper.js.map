{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/block-wrapper.js"],"names":["BlockComponent","wrapper","children","tagName","__unstableIsHtml","props","onSelectionStart","Context","setBlockNodes","SetBlockNodes","BlockListBlockContext","clientId","rootClientId","isSelected","isFirstMultiSelected","isLastMultiSelected","isMultiSelecting","isNavigationMode","isPartOfMultiSelection","enableAnimation","index","className","isLocked","name","mode","blockTitle","wrapperProps","select","initialPosition","getSelectedBlocksInitialCaretPosition","removeBlock","insertDefaultBlock","fallbackRef","isAligned","node","current","nodes","blockLabel","focusTabbable","document","activeElement","textInputs","focus","tabbable","find","filter","isTextField","closest","isReverse","target","last","first","animationStyle","onKeyDown","event","keyCode","ENTER","BACKSPACE","DELETE","preventDefault","onMouseLeave","which","buttons","htmlSuffix","blockElementId","Animated","animated","blockWrapper","undefined","style","alignmentWrapperProps","ExtendedBlockComponent","ELEMENTS","reduce","acc","element","ref","Block"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { first, last, omit } from 'lodash';\nimport { animated } from 'react-spring/web.cjs';\n\n/**\n * WordPress dependencies\n */\nimport { useRef, useEffect, useContext, forwardRef } from '@wordpress/element';\nimport { focus, isTextField, placeCaretAtHorizontalEdge } from '@wordpress/dom';\nimport { BACKSPACE, DELETE, ENTER } from '@wordpress/keycodes';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { useSelect, useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { isInsideRootBlock } from '../../utils/dom';\nimport useMovingAnimation from '../use-moving-animation';\nimport { Context, SetBlockNodes } from './root-container';\nimport { BlockListBlockContext } from './block';\nimport ELEMENTS from './block-wrapper-elements';\n\nconst BlockComponent = forwardRef(\n\t( { children, tagName = 'div', __unstableIsHtml, ...props }, wrapper ) => {\n\t\tconst onSelectionStart = useContext( Context );\n\t\tconst setBlockNodes = useContext( SetBlockNodes );\n\t\tconst {\n\t\t\tclientId,\n\t\t\trootClientId,\n\t\t\tisSelected,\n\t\t\tisFirstMultiSelected,\n\t\t\tisLastMultiSelected,\n\t\t\tisMultiSelecting,\n\t\t\tisNavigationMode,\n\t\t\tisPartOfMultiSelection,\n\t\t\tenableAnimation,\n\t\t\tindex,\n\t\t\tclassName,\n\t\t\tisLocked,\n\t\t\tname,\n\t\t\tmode,\n\t\t\tblockTitle,\n\t\t\twrapperProps,\n\t\t} = useContext( BlockListBlockContext );\n\t\tconst { initialPosition } = useSelect(\n\t\t\t( select ) => {\n\t\t\t\tif ( ! isSelected ) {\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tinitialPosition: select(\n\t\t\t\t\t\t'core/block-editor'\n\t\t\t\t\t).getSelectedBlocksInitialCaretPosition(),\n\t\t\t\t};\n\t\t\t},\n\t\t\t[ isSelected ]\n\t\t);\n\t\tconst { removeBlock, insertDefaultBlock } = useDispatch(\n\t\t\t'core/block-editor'\n\t\t);\n\t\tconst fallbackRef = useRef();\n\t\tconst isAligned = wrapperProps && !! wrapperProps[ 'data-align' ];\n\t\twrapper = wrapper || fallbackRef;\n\n\t\t// Provide the selected node, or the first and last nodes of a multi-\n\t\t// selection, so it can be used to position the contextual block toolbar.\n\t\t// We only provide what is necessary, and remove the nodes again when they\n\t\t// are no longer selected.\n\t\tuseEffect( () => {\n\t\t\tif ( isSelected || isFirstMultiSelected || isLastMultiSelected ) {\n\t\t\t\tconst node = wrapper.current;\n\t\t\t\tsetBlockNodes( ( nodes ) => ( {\n\t\t\t\t\t...nodes,\n\t\t\t\t\t[ clientId ]: node,\n\t\t\t\t} ) );\n\t\t\t\treturn () => {\n\t\t\t\t\tsetBlockNodes( ( nodes ) => omit( nodes, clientId ) );\n\t\t\t\t};\n\t\t\t}\n\t\t}, [ isSelected, isFirstMultiSelected, isLastMultiSelected ] );\n\n\t\t// translators: %s: Type of block (i.e. Text, Image etc)\n\t\tconst blockLabel = sprintf( __( 'Block: %s' ), blockTitle );\n\n\t\t// Handing the focus of the block on creation and update\n\n\t\t/**\n\t\t * When a block becomes selected, transition focus to an inner tabbable.\n\t\t */\n\t\tconst focusTabbable = () => {\n\t\t\t// Focus is captured by the wrapper node, so while focus transition\n\t\t\t// should only consider tabbables within editable display, since it\n\t\t\t// may be the wrapper itself or a side control which triggered the\n\t\t\t// focus event, don't unnecessary transition to an inner tabbable.\n\t\t\tif (\n\t\t\t\tdocument.activeElement &&\n\t\t\t\tisInsideRootBlock( wrapper.current, document.activeElement )\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Find all tabbables within node.\n\t\t\tconst textInputs = focus.tabbable\n\t\t\t\t.find( wrapper.current )\n\t\t\t\t.filter( isTextField )\n\t\t\t\t// Exclude inner blocks and block appenders\n\t\t\t\t.filter(\n\t\t\t\t\t( node ) =>\n\t\t\t\t\t\tisInsideRootBlock( wrapper.current, node ) &&\n\t\t\t\t\t\t! node.closest( '.block-list-appender' )\n\t\t\t\t);\n\n\t\t\t// If reversed (e.g. merge via backspace), use the last in the set of\n\t\t\t// tabbables.\n\t\t\tconst isReverse = -1 === initialPosition;\n\t\t\tconst target =\n\t\t\t\t( isReverse ? last : first )( textInputs ) || wrapper.current;\n\n\t\t\tplaceCaretAtHorizontalEdge( target, isReverse );\n\t\t};\n\n\t\tuseEffect( () => {\n\t\t\tif ( ! isMultiSelecting && ! isNavigationMode && isSelected ) {\n\t\t\t\tfocusTabbable();\n\t\t\t}\n\t\t}, [ isSelected, isMultiSelecting, isNavigationMode ] );\n\n\t\t// Block Reordering animation\n\t\tconst animationStyle = useMovingAnimation(\n\t\t\twrapper,\n\t\t\tisSelected || isPartOfMultiSelection,\n\t\t\tisSelected || isFirstMultiSelected,\n\t\t\tenableAnimation,\n\t\t\tindex\n\t\t);\n\n\t\t/**\n\t\t * Interprets keydown event intent to remove or insert after block if key\n\t\t * event occurs on wrapper node. This can occur when the block has no text\n\t\t * fields of its own, particularly after initial insertion, to allow for\n\t\t * easy deletion and continuous writing flow to add additional content.\n\t\t *\n\t\t * @param {KeyboardEvent} event Keydown event.\n\t\t */\n\t\tconst onKeyDown = ( event ) => {\n\t\t\tconst { keyCode, target } = event;\n\n\t\t\tif ( props.onKeyDown ) {\n\t\t\t\tprops.onKeyDown( event );\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tkeyCode !== ENTER &&\n\t\t\t\tkeyCode !== BACKSPACE &&\n\t\t\t\tkeyCode !== DELETE\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( target !== wrapper.current || isTextField( target ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\n\t\t\tif ( keyCode === ENTER ) {\n\t\t\t\tinsertDefaultBlock( {}, rootClientId, index + 1 );\n\t\t\t} else {\n\t\t\t\tremoveBlock( clientId );\n\t\t\t}\n\t\t};\n\n\t\tconst onMouseLeave = ( { which, buttons } ) => {\n\t\t\t// The primary button must be pressed to initiate selection. Fall back\n\t\t\t// to `which` if the standard `buttons` property is falsy. There are\n\t\t\t// cases where Firefox might always set `buttons` to `0`.\n\t\t\t// See https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/buttons\n\t\t\t// See https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/which\n\t\t\tif ( ( buttons || which ) === 1 ) {\n\t\t\t\tonSelectionStart( clientId );\n\t\t\t}\n\t\t};\n\n\t\tconst htmlSuffix =\n\t\t\tmode === 'html' && ! __unstableIsHtml ? '-visual' : '';\n\t\tconst blockElementId = `block-${ clientId }${ htmlSuffix }`;\n\t\tconst Animated = animated[ tagName ];\n\n\t\tconst blockWrapper = (\n\t\t\t<Animated\n\t\t\t\t// Overrideable props.\n\t\t\t\taria-label={ blockLabel }\n\t\t\t\trole=\"group\"\n\t\t\t\t{ ...omit( wrapperProps, [ 'data-align' ] ) }\n\t\t\t\t{ ...props }\n\t\t\t\tid={ blockElementId }\n\t\t\t\tref={ wrapper }\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\tclassName,\n\t\t\t\t\tprops.className,\n\t\t\t\t\twrapperProps && wrapperProps.className,\n\t\t\t\t\t! isAligned && 'wp-block'\n\t\t\t\t) }\n\t\t\t\tdata-block={ clientId }\n\t\t\t\tdata-type={ name }\n\t\t\t\tdata-title={ blockTitle }\n\t\t\t\t// Only allow shortcuts when a blocks is selected and not locked.\n\t\t\t\tonKeyDown={ isSelected && ! isLocked ? onKeyDown : undefined }\n\t\t\t\t// Only allow selection to be started from a selected block.\n\t\t\t\tonMouseLeave={ isSelected ? onMouseLeave : undefined }\n\t\t\t\ttabIndex=\"0\"\n\t\t\t\tstyle={ {\n\t\t\t\t\t...( wrapperProps ? wrapperProps.style : {} ),\n\t\t\t\t\t...( props.style || {} ),\n\t\t\t\t\t...animationStyle,\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</Animated>\n\t\t);\n\n\t\t// For aligned blocks, provide a wrapper element so the block can be\n\t\t// positioned relative to the block column.\n\t\tif ( isAligned ) {\n\t\t\tconst alignmentWrapperProps = {\n\t\t\t\t'data-align': wrapperProps[ 'data-align' ],\n\t\t\t};\n\t\t\treturn (\n\t\t\t\t<div className=\"wp-block\" { ...alignmentWrapperProps }>\n\t\t\t\t\t{ blockWrapper }\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\treturn blockWrapper;\n\t}\n);\n\nconst ExtendedBlockComponent = ELEMENTS.reduce( ( acc, element ) => {\n\tacc[ element ] = forwardRef( ( props, ref ) => {\n\t\treturn <BlockComponent { ...props } ref={ ref } tagName={ element } />;\n\t} );\n\treturn acc;\n}, BlockComponent );\n\nexport const Block = ExtendedBlockComponent;\n"]}