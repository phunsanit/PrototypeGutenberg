{"version":3,"sources":["@wordpress/block-editor/src/components/block-toolbar/utils.js"],"names":["window","clearTimeout","requestAnimationFrame","cancelAnimationFrame","setTimeout","DEBOUNCE_TIMEOUT","useDebouncedShowMovers","ref","isFocused","debounceTimeout","onChange","noop","showMovers","setShowMovers","timeoutRef","handleOnChange","nextIsFocused","getIsHovered","current","matches","shouldHideMovers","isHovered","clearTimeoutRef","timeout","debouncedShowMovers","event","stopPropagation","debouncedHideMovers","useShowMoversGestures","setIsFocused","registerRef","isFocusedWithin","contains","document","activeElement","node","handleOnFocus","handleOnBlur","addEventListener","removeEventListener","gestures","onMouseMove","onMouseLeave","requestAnimationFrameId","useToggleBlockHighlight","clientId","toggleBlockHighlight","updateBlockHighlight"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop } from 'lodash';\n/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { useState, useRef, useEffect, useCallback } from '@wordpress/element';\n\nconst {\n\tclearTimeout,\n\trequestAnimationFrame,\n\tcancelAnimationFrame,\n\tsetTimeout,\n} = window;\nconst DEBOUNCE_TIMEOUT = 250;\n\n/**\n * Hook that creates a showMover state, as well as debounced show/hide callbacks\n */\nexport function useDebouncedShowMovers( {\n\tref,\n\tisFocused,\n\tdebounceTimeout = DEBOUNCE_TIMEOUT,\n\tonChange = noop,\n} ) {\n\tconst [ showMovers, setShowMovers ] = useState( false );\n\tconst timeoutRef = useRef();\n\n\tconst handleOnChange = ( nextIsFocused ) => {\n\t\tsetShowMovers( nextIsFocused );\n\t\tonChange( nextIsFocused );\n\t};\n\n\tconst getIsHovered = () => {\n\t\treturn ref?.current && ref.current.matches( ':hover' );\n\t};\n\n\tconst shouldHideMovers = () => {\n\t\tconst isHovered = getIsHovered();\n\n\t\treturn ! isFocused && ! isHovered;\n\t};\n\n\tconst clearTimeoutRef = () => {\n\t\tconst timeout = timeoutRef.current;\n\n\t\tif ( timeout && clearTimeout ) {\n\t\t\tclearTimeout( timeout );\n\t\t}\n\t};\n\n\tconst debouncedShowMovers = ( event ) => {\n\t\tif ( event ) {\n\t\t\tevent.stopPropagation();\n\t\t}\n\n\t\tclearTimeoutRef();\n\n\t\tif ( ! showMovers ) {\n\t\t\thandleOnChange( true );\n\t\t}\n\t};\n\n\tconst debouncedHideMovers = ( event ) => {\n\t\tif ( event ) {\n\t\t\tevent.stopPropagation();\n\t\t}\n\n\t\tclearTimeoutRef();\n\n\t\ttimeoutRef.current = setTimeout( () => {\n\t\t\tif ( shouldHideMovers() ) {\n\t\t\t\thandleOnChange( false );\n\t\t\t}\n\t\t}, debounceTimeout );\n\t};\n\n\tuseEffect( () => () => clearTimeoutRef(), [] );\n\n\treturn {\n\t\tshowMovers,\n\t\tdebouncedShowMovers,\n\t\tdebouncedHideMovers,\n\t};\n}\n\n/**\n * Hook that provides a showMovers state and gesture events for DOM elements\n * that interact with the showMovers state.\n */\nexport function useShowMoversGestures( {\n\tref,\n\tdebounceTimeout = DEBOUNCE_TIMEOUT,\n\tonChange = noop,\n} ) {\n\tconst [ isFocused, setIsFocused ] = useState( false );\n\tconst {\n\t\tshowMovers,\n\t\tdebouncedShowMovers,\n\t\tdebouncedHideMovers,\n\t} = useDebouncedShowMovers( { ref, debounceTimeout, isFocused, onChange } );\n\n\tconst registerRef = useRef( false );\n\n\tconst isFocusedWithin = () => {\n\t\treturn ref?.current && ref.current.contains( document.activeElement );\n\t};\n\n\tuseEffect( () => {\n\t\tconst node = ref.current;\n\n\t\tconst handleOnFocus = () => {\n\t\t\tif ( isFocusedWithin() ) {\n\t\t\t\tsetIsFocused( true );\n\t\t\t\tdebouncedShowMovers();\n\t\t\t}\n\t\t};\n\n\t\tconst handleOnBlur = () => {\n\t\t\tif ( ! isFocusedWithin() ) {\n\t\t\t\tsetIsFocused( false );\n\t\t\t\tdebouncedHideMovers();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Events are added via DOM events (vs. React synthetic events),\n\t\t * as the child React components swallow mouse events.\n\t\t */\n\t\tif ( node && ! registerRef.current ) {\n\t\t\tnode.addEventListener( 'focus', handleOnFocus, true );\n\t\t\tnode.addEventListener( 'blur', handleOnBlur, true );\n\t\t\tregisterRef.current = true;\n\t\t}\n\n\t\treturn () => {\n\t\t\tif ( node ) {\n\t\t\t\tnode.removeEventListener( 'focus', handleOnFocus );\n\t\t\t\tnode.removeEventListener( 'blur', handleOnBlur );\n\t\t\t}\n\t\t};\n\t}, [\n\t\tref,\n\t\tregisterRef,\n\t\tsetIsFocused,\n\t\tdebouncedShowMovers,\n\t\tdebouncedHideMovers,\n\t] );\n\n\treturn {\n\t\tshowMovers,\n\t\tgestures: {\n\t\t\tonMouseMove: debouncedShowMovers,\n\t\t\tonMouseLeave: debouncedHideMovers,\n\t\t},\n\t};\n}\n\nlet requestAnimationFrameId;\n\n/**\n * Hook that toggles the highlight (outline) state of a block\n *\n * @param {string} clientId The block's clientId\n *\n * @return {Function} Callback function to toggle highlight state.\n */\nexport function useToggleBlockHighlight( clientId ) {\n\tconst { toggleBlockHighlight } = useDispatch( 'core/block-editor' );\n\n\tconst updateBlockHighlight = useCallback(\n\t\t( isFocused ) => {\n\t\t\ttoggleBlockHighlight( clientId, isFocused );\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tuseEffect( () => {\n\t\t// On mount, we make sure to cancel any pending animation frame request\n\t\t// that hasn't been completed yet. Components like NavigableToolbar may\n\t\t// mount and unmount quickly.\n\t\tif ( requestAnimationFrameId ) {\n\t\t\tcancelAnimationFrame( requestAnimationFrameId );\n\t\t}\n\t\treturn () => {\n\t\t\t// Sequences state change to enable editor updates (e.g. cursor\n\t\t\t// position) to render correctly.\n\t\t\trequestAnimationFrameId = requestAnimationFrame( () => {\n\t\t\t\tupdateBlockHighlight( false );\n\t\t\t} );\n\t\t};\n\t}, [] );\n\n\treturn updateBlockHighlight;\n}\n"]}