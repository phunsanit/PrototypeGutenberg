{"version":3,"sources":["@wordpress/block-editor/src/components/media-placeholder/index.js"],"names":["InsertFromURLPopover","src","onChange","onSubmit","onClose","keyboardReturn","MediaPlaceholder","arguments","state","isURLInputVisible","onChangeSrc","bind","onSubmitSrc","onUpload","onFilesUpload","openURLInput","closeURLInput","allowedTypes","props","allowedType","setState","value","prevProps","event","target","preventDefault","onSelectURL","files","addToGallery","mediaUpload","multiple","onError","onSelect","setMedia","lastMediaPassed","newMedia","filteredMedia","filter","item","id","some","Number","urlSlug","url","includes","concat","map","media","cutOffIndex","lastIndexOf","slice","filesList","onFileChange","content","onClick","className","icon","isAppender","labels","onDoubleClick","mediaPreview","notices","children","instructions","title","undefined","isOneType","length","isAudio","isImage","isVideo","placeholderClassName","disableDropZone","onHTMLDrop","noop","onCancel","accept","mediaLibraryButton","onlyAllowsImages","open","stopPropagation","renderDropZone","openFileDialog","renderUrlSelectionUI","renderCancelLink","renderPlaceholder","disableMediaButtons","dropZoneUIOnly","alternative","renderMediaUploadChecked","Component","applyWithSelect","select","getSettings"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { every, get, isArray, noop, startsWith } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tButton,\n\tFormFileUpload,\n\tPlaceholder,\n\tDropZone,\n\twithFilters,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { compose } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport deprecated from '@wordpress/deprecated';\nimport { keyboardReturn } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport MediaUpload from '../media-upload';\nimport MediaUploadCheck from '../media-upload/check';\nimport URLPopover from '../url-popover';\n\nconst InsertFromURLPopover = ( { src, onChange, onSubmit, onClose } ) => (\n\t<URLPopover onClose={ onClose }>\n\t\t<form\n\t\t\tclassName=\"block-editor-media-placeholder__url-input-form\"\n\t\t\tonSubmit={ onSubmit }\n\t\t>\n\t\t\t<input\n\t\t\t\tclassName=\"block-editor-media-placeholder__url-input-field\"\n\t\t\t\ttype=\"url\"\n\t\t\t\taria-label={ __( 'URL' ) }\n\t\t\t\tplaceholder={ __( 'Paste or type URL' ) }\n\t\t\t\tonChange={ onChange }\n\t\t\t\tvalue={ src }\n\t\t\t/>\n\t\t\t<Button\n\t\t\t\tclassName=\"block-editor-media-placeholder__url-input-submit-button\"\n\t\t\t\ticon={ keyboardReturn }\n\t\t\t\tlabel={ __( 'Apply' ) }\n\t\t\t\ttype=\"submit\"\n\t\t\t/>\n\t\t</form>\n\t</URLPopover>\n);\n\nexport class MediaPlaceholder extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\tsrc: '',\n\t\t\tisURLInputVisible: false,\n\t\t};\n\t\tthis.onChangeSrc = this.onChangeSrc.bind( this );\n\t\tthis.onSubmitSrc = this.onSubmitSrc.bind( this );\n\t\tthis.onUpload = this.onUpload.bind( this );\n\t\tthis.onFilesUpload = this.onFilesUpload.bind( this );\n\t\tthis.openURLInput = this.openURLInput.bind( this );\n\t\tthis.closeURLInput = this.closeURLInput.bind( this );\n\t}\n\n\tonlyAllowsImages() {\n\t\tconst { allowedTypes } = this.props;\n\t\tif ( ! allowedTypes ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn every( allowedTypes, ( allowedType ) => {\n\t\t\treturn (\n\t\t\t\tallowedType === 'image' || startsWith( allowedType, 'image/' )\n\t\t\t);\n\t\t} );\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.setState( { src: get( this.props.value, [ 'src' ], '' ) } );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif (\n\t\t\tget( prevProps.value, [ 'src' ], '' ) !==\n\t\t\tget( this.props.value, [ 'src' ], '' )\n\t\t) {\n\t\t\tthis.setState( { src: get( this.props.value, [ 'src' ], '' ) } );\n\t\t}\n\t}\n\n\tonChangeSrc( event ) {\n\t\tthis.setState( { src: event.target.value } );\n\t}\n\n\tonSubmitSrc( event ) {\n\t\tevent.preventDefault();\n\t\tif ( this.state.src && this.props.onSelectURL ) {\n\t\t\tthis.props.onSelectURL( this.state.src );\n\t\t\tthis.closeURLInput();\n\t\t}\n\t}\n\n\tonUpload( event ) {\n\t\tthis.onFilesUpload( event.target.files );\n\t}\n\n\tonFilesUpload( files ) {\n\t\tconst {\n\t\t\taddToGallery,\n\t\t\tallowedTypes,\n\t\t\tmediaUpload,\n\t\t\tmultiple,\n\t\t\tonError,\n\t\t\tonSelect,\n\t\t} = this.props;\n\t\tlet setMedia;\n\t\tif ( multiple ) {\n\t\t\tif ( addToGallery ) {\n\t\t\t\t// To allow changes to a gallery to be made while uploads are in progress\n\t\t\t\t// (including trigging multiple upload groups and removing already in place images),\n\t\t\t\t// we must be able to add newMedia based on the current value of the Gallery\n\t\t\t\t// whenever the setMedia function runs (not destructuring 'value' from props).\n\t\t\t\t// Additionally, since the setMedia function runs multiple times per upload group\n\t\t\t\t// and is passed newMedia containing every item in its group each time, we must\n\t\t\t\t// also filter out whatever this upload group had previously returned to the\n\t\t\t\t// gallery before adding and returning the image array with replacement newMedia\n\t\t\t\t// values.\n\n\t\t\t\t// Define an array to store urls from newMedia between subsequent function calls.\n\t\t\t\tlet lastMediaPassed = [];\n\t\t\t\tsetMedia = ( newMedia ) => {\n\t\t\t\t\t// Remove any images this upload group is responsible for (lastMediaPassed).\n\t\t\t\t\t// Their replacements are contained in newMedia.\n\t\t\t\t\tconst filteredMedia = ( this.props.value || [] ).filter(\n\t\t\t\t\t\t( item ) => {\n\t\t\t\t\t\t\t// If Item has id, only remove it if lastMediaPassed has an item with that id.\n\t\t\t\t\t\t\tif ( item.id ) {\n\t\t\t\t\t\t\t\treturn ! lastMediaPassed.some(\n\t\t\t\t\t\t\t\t\t// Be sure to convert to number for comparison.\n\t\t\t\t\t\t\t\t\t( { id } ) =>\n\t\t\t\t\t\t\t\t\t\tNumber( id ) === Number( item.id )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Compare transient images via .includes since gallery may append extra info onto the url.\n\t\t\t\t\t\t\treturn ! lastMediaPassed.some( ( { urlSlug } ) =>\n\t\t\t\t\t\t\t\titem.url.includes( urlSlug )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\t// Return the filtered media array along with newMedia.\n\t\t\t\t\tonSelect( filteredMedia.concat( newMedia ) );\n\t\t\t\t\t// Reset lastMediaPassed and set it with ids and urls from newMedia.\n\t\t\t\t\tlastMediaPassed = newMedia.map( ( media ) => {\n\t\t\t\t\t\t// Add everything up to '.fileType' to compare via .includes.\n\t\t\t\t\t\tconst cutOffIndex = media.url.lastIndexOf( '.' );\n\t\t\t\t\t\tconst urlSlug = media.url.slice( 0, cutOffIndex );\n\t\t\t\t\t\treturn { id: media.id, urlSlug };\n\t\t\t\t\t} );\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tsetMedia = onSelect;\n\t\t\t}\n\t\t} else {\n\t\t\tsetMedia = ( [ media ] ) => onSelect( media );\n\t\t}\n\t\tmediaUpload( {\n\t\t\tallowedTypes,\n\t\t\tfilesList: files,\n\t\t\tonFileChange: setMedia,\n\t\t\tonError,\n\t\t} );\n\t}\n\n\topenURLInput() {\n\t\tthis.setState( { isURLInputVisible: true } );\n\t}\n\n\tcloseURLInput() {\n\t\tthis.setState( { isURLInputVisible: false } );\n\t}\n\n\trenderPlaceholder( content, onClick ) {\n\t\tconst {\n\t\t\tallowedTypes = [],\n\t\t\tclassName,\n\t\t\ticon,\n\t\t\tisAppender,\n\t\t\tlabels = {},\n\t\t\tonDoubleClick,\n\t\t\tmediaPreview,\n\t\t\tnotices,\n\t\t\tonSelectURL,\n\t\t\tmediaUpload,\n\t\t\tchildren,\n\t\t} = this.props;\n\n\t\tlet instructions = labels.instructions;\n\t\tlet title = labels.title;\n\n\t\tif ( ! mediaUpload && ! onSelectURL ) {\n\t\t\tinstructions = __(\n\t\t\t\t'To edit this block, you need permission to upload media.'\n\t\t\t);\n\t\t}\n\n\t\tif ( instructions === undefined || title === undefined ) {\n\t\t\tconst isOneType = 1 === allowedTypes.length;\n\t\t\tconst isAudio = isOneType && 'audio' === allowedTypes[ 0 ];\n\t\t\tconst isImage = isOneType && 'image' === allowedTypes[ 0 ];\n\t\t\tconst isVideo = isOneType && 'video' === allowedTypes[ 0 ];\n\n\t\t\tif ( instructions === undefined && mediaUpload ) {\n\t\t\t\tinstructions = __(\n\t\t\t\t\t'Upload a media file or pick one from your media library.'\n\t\t\t\t);\n\n\t\t\t\tif ( isAudio ) {\n\t\t\t\t\tinstructions = __(\n\t\t\t\t\t\t'Upload an audio file, pick one from your media library, or add one with a URL.'\n\t\t\t\t\t);\n\t\t\t\t} else if ( isImage ) {\n\t\t\t\t\tinstructions = __(\n\t\t\t\t\t\t'Upload an image file, pick one from your media library, or add one with a URL.'\n\t\t\t\t\t);\n\t\t\t\t} else if ( isVideo ) {\n\t\t\t\t\tinstructions = __(\n\t\t\t\t\t\t'Upload a video file, pick one from your media library, or add one with a URL.'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( title === undefined ) {\n\t\t\t\ttitle = __( 'Media' );\n\n\t\t\t\tif ( isAudio ) {\n\t\t\t\t\ttitle = __( 'Audio' );\n\t\t\t\t} else if ( isImage ) {\n\t\t\t\t\ttitle = __( 'Image' );\n\t\t\t\t} else if ( isVideo ) {\n\t\t\t\t\ttitle = __( 'Video' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst placeholderClassName = classnames(\n\t\t\t'block-editor-media-placeholder',\n\t\t\tclassName,\n\t\t\t{\n\t\t\t\t'is-appender': isAppender,\n\t\t\t}\n\t\t);\n\n\t\treturn (\n\t\t\t<Placeholder\n\t\t\t\ticon={ icon }\n\t\t\t\tlabel={ title }\n\t\t\t\tinstructions={ instructions }\n\t\t\t\tclassName={ placeholderClassName }\n\t\t\t\tnotices={ notices }\n\t\t\t\tonClick={ onClick }\n\t\t\t\tonDoubleClick={ onDoubleClick }\n\t\t\t\tpreview={ mediaPreview }\n\t\t\t>\n\t\t\t\t{ content }\n\t\t\t\t{ children }\n\t\t\t</Placeholder>\n\t\t);\n\t}\n\n\trenderDropZone() {\n\t\tconst { disableDropZone, onHTMLDrop = noop } = this.props;\n\n\t\tif ( disableDropZone ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn (\n\t\t\t<DropZone\n\t\t\t\tonFilesDrop={ this.onFilesUpload }\n\t\t\t\tonHTMLDrop={ onHTMLDrop }\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderCancelLink() {\n\t\tconst { onCancel } = this.props;\n\t\treturn (\n\t\t\tonCancel && (\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"block-editor-media-placeholder__cancel-button\"\n\t\t\t\t\ttitle={ __( 'Cancel' ) }\n\t\t\t\t\tisLink\n\t\t\t\t\tonClick={ onCancel }\n\t\t\t\t>\n\t\t\t\t\t{ __( 'Cancel' ) }\n\t\t\t\t</Button>\n\t\t\t)\n\t\t);\n\t}\n\n\trenderUrlSelectionUI() {\n\t\tconst { onSelectURL } = this.props;\n\t\tif ( ! onSelectURL ) {\n\t\t\treturn null;\n\t\t}\n\t\tconst { isURLInputVisible, src } = this.state;\n\t\treturn (\n\t\t\t<div className=\"block-editor-media-placeholder__url-input-container\">\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"block-editor-media-placeholder__button\"\n\t\t\t\t\tonClick={ this.openURLInput }\n\t\t\t\t\tisPressed={ isURLInputVisible }\n\t\t\t\t\tisTertiary\n\t\t\t\t>\n\t\t\t\t\t{ __( 'Insert from URL' ) }\n\t\t\t\t</Button>\n\t\t\t\t{ isURLInputVisible && (\n\t\t\t\t\t<InsertFromURLPopover\n\t\t\t\t\t\tsrc={ src }\n\t\t\t\t\t\tonChange={ this.onChangeSrc }\n\t\t\t\t\t\tonSubmit={ this.onSubmitSrc }\n\t\t\t\t\t\tonClose={ this.closeURLInput }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderMediaUploadChecked() {\n\t\tconst {\n\t\t\taccept,\n\t\t\taddToGallery,\n\t\t\tallowedTypes = [],\n\t\t\tisAppender,\n\t\t\tmediaUpload,\n\t\t\tmultiple = false,\n\t\t\tonSelect,\n\t\t\tvalue = {},\n\t\t} = this.props;\n\n\t\tconst mediaLibraryButton = (\n\t\t\t<MediaUpload\n\t\t\t\taddToGallery={ addToGallery }\n\t\t\t\tgallery={ multiple && this.onlyAllowsImages() }\n\t\t\t\tmultiple={ multiple }\n\t\t\t\tonSelect={ onSelect }\n\t\t\t\tallowedTypes={ allowedTypes }\n\t\t\t\tvalue={\n\t\t\t\t\tisArray( value ) ? value.map( ( { id } ) => id ) : value.id\n\t\t\t\t}\n\t\t\t\trender={ ( { open } ) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tisTertiary\n\t\t\t\t\t\t\tonClick={ ( event ) => {\n\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\topen();\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'Media Library' ) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\n\t\tif ( mediaUpload && isAppender ) {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t{ this.renderDropZone() }\n\t\t\t\t\t<FormFileUpload\n\t\t\t\t\t\tonChange={ this.onUpload }\n\t\t\t\t\t\taccept={ accept }\n\t\t\t\t\t\tmultiple={ multiple }\n\t\t\t\t\t\trender={ ( { openFileDialog } ) => {\n\t\t\t\t\t\t\tconst content = (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tisPrimary\n\t\t\t\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t\t\t\t'block-editor-media-placeholder__button',\n\t\t\t\t\t\t\t\t\t\t\t'block-editor-media-placeholder__upload-button'\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ __( 'Upload' ) }\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t{ mediaLibraryButton }\n\t\t\t\t\t\t\t\t\t{ this.renderUrlSelectionUI() }\n\t\t\t\t\t\t\t\t\t{ this.renderCancelLink() }\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treturn this.renderPlaceholder(\n\t\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\t\topenFileDialog\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t);\n\t\t}\n\n\t\tif ( mediaUpload ) {\n\t\t\tconst content = (\n\t\t\t\t<>\n\t\t\t\t\t{ this.renderDropZone() }\n\t\t\t\t\t<FormFileUpload\n\t\t\t\t\t\tisPrimary\n\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t'block-editor-media-placeholder__button',\n\t\t\t\t\t\t\t'block-editor-media-placeholder__upload-button'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tonChange={ this.onUpload }\n\t\t\t\t\t\taccept={ accept }\n\t\t\t\t\t\tmultiple={ multiple }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Upload' ) }\n\t\t\t\t\t</FormFileUpload>\n\t\t\t\t\t{ mediaLibraryButton }\n\t\t\t\t\t{ this.renderUrlSelectionUI() }\n\t\t\t\t\t{ this.renderCancelLink() }\n\t\t\t\t</>\n\t\t\t);\n\t\t\treturn this.renderPlaceholder( content );\n\t\t}\n\n\t\treturn this.renderPlaceholder( mediaLibraryButton );\n\t}\n\n\trender() {\n\t\tconst { disableMediaButtons, dropZoneUIOnly } = this.props;\n\n\t\tif ( dropZoneUIOnly || disableMediaButtons ) {\n\t\t\tif ( dropZoneUIOnly ) {\n\t\t\t\tdeprecated(\n\t\t\t\t\t'wp.blockEditor.MediaPlaceholder dropZoneUIOnly prop',\n\t\t\t\t\t{\n\t\t\t\t\t\talternative: 'disableMediaButtons',\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<MediaUploadCheck>{ this.renderDropZone() }</MediaUploadCheck>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<MediaUploadCheck\n\t\t\t\tfallback={ this.renderPlaceholder(\n\t\t\t\t\tthis.renderUrlSelectionUI()\n\t\t\t\t) }\n\t\t\t>\n\t\t\t\t{ this.renderMediaUploadChecked() }\n\t\t\t</MediaUploadCheck>\n\t\t);\n\t}\n}\n\nconst applyWithSelect = withSelect( ( select ) => {\n\tconst { getSettings } = select( 'core/block-editor' );\n\n\treturn {\n\t\tmediaUpload: getSettings().mediaUpload,\n\t};\n} );\n\n/**\n * @see https://github.com/WordPress/gutenberg/blob/master/packages/block-editor/src/components/media-placeholder/README.md\n */\nexport default compose(\n\tapplyWithSelect,\n\twithFilters( 'editor.MediaPlaceholder' )\n)( MediaPlaceholder );\n"]}