{"version":3,"sources":["@wordpress/block-editor/src/components/media-replace-flow/index.js"],"names":["MediaReplaceFlow","mediaURL","mediaId","allowedTypes","accept","onSelect","onSelectURL","name","createNotice","removeNotice","mediaURLValue","setMediaURLValue","mediaUpload","select","getSettings","editMediaButtonRef","errorNoticeID","onError","message","errorElement","document","createElement","innerHTML","renderMsg","textContent","innerText","setTimeout","speak","id","isDismissible","selectMedia","media","url","selectURL","newURL","uploadFiles","event","files","target","setMedia","filesList","onFileChange","openOnArrowDown","keyCode","DOWN","preventDefault","stopPropagation","click","isOpen","onToggle","onClose","open","mediaIcon","openFileDialog","upload","current","focus","dispatch"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { uniqueId } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useState, createRef, renderToString } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { speak } from '@wordpress/a11y';\nimport {\n\tFormFileUpload,\n\tNavigableMenu,\n\tMenuItem,\n\tToolbarGroup,\n\tButton,\n\tDropdown,\n} from '@wordpress/components';\nimport { withDispatch, useSelect } from '@wordpress/data';\nimport { DOWN } from '@wordpress/keycodes';\nimport { compose } from '@wordpress/compose';\nimport { upload, media as mediaIcon } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport MediaUpload from '../media-upload';\nimport MediaUploadCheck from '../media-upload/check';\nimport LinkControl from '../link-control';\n\nconst MediaReplaceFlow = ( {\n\tmediaURL,\n\tmediaId,\n\tallowedTypes,\n\taccept,\n\tonSelect,\n\tonSelectURL,\n\tname = __( 'Replace' ),\n\tcreateNotice,\n\tremoveNotice,\n} ) => {\n\tconst [ mediaURLValue, setMediaURLValue ] = useState( mediaURL );\n\tconst mediaUpload = useSelect( ( select ) => {\n\t\treturn select( 'core/block-editor' ).getSettings().mediaUpload;\n\t}, [] );\n\tconst editMediaButtonRef = createRef();\n\tconst errorNoticeID = uniqueId(\n\t\t'block-editor/media-replace-flow/error-notice/'\n\t);\n\n\tconst onError = ( message ) => {\n\t\tconst errorElement = document.createElement( 'div' );\n\t\terrorElement.innerHTML = renderToString( message );\n\t\t// The default error contains some HTML that,\n\t\t// for example, makes the filename bold.\n\t\t// The notice, by default, accepts strings only and so\n\t\t// we need to remove the html from the error.\n\t\tconst renderMsg =\n\t\t\terrorElement.textContent || errorElement.innerText || '';\n\t\t// We need to set a timeout for showing the notice\n\t\t// so that VoiceOver and possibly other screen readers\n\t\t// can announce the error afer the toolbar button\n\t\t// regains focus once the upload dialog closes.\n\t\t// Otherwise VO simply skips over the notice and announces\n\t\t// the focused element and the open menu.\n\t\tsetTimeout( () => {\n\t\t\tcreateNotice( 'error', renderMsg, {\n\t\t\t\tspeak: true,\n\t\t\t\tid: errorNoticeID,\n\t\t\t\tisDismissible: true,\n\t\t\t} );\n\t\t}, 1000 );\n\t};\n\n\tconst selectMedia = ( media ) => {\n\t\tonSelect( media );\n\t\tsetMediaURLValue( media.url );\n\t\tspeak( __( 'The media file has been replaced' ) );\n\t\tremoveNotice( errorNoticeID );\n\t};\n\n\tconst selectURL = ( newURL ) => {\n\t\tonSelectURL( newURL );\n\t};\n\n\tconst uploadFiles = ( event ) => {\n\t\tconst files = event.target.files;\n\t\tconst setMedia = ( [ media ] ) => {\n\t\t\tselectMedia( media );\n\t\t};\n\t\tmediaUpload( {\n\t\t\tallowedTypes,\n\t\t\tfilesList: files,\n\t\t\tonFileChange: setMedia,\n\t\t\tonError,\n\t\t} );\n\t};\n\n\tconst openOnArrowDown = ( event ) => {\n\t\tif ( event.keyCode === DOWN ) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tevent.target.click();\n\t\t}\n\t};\n\n\treturn (\n\t\t<Dropdown\n\t\t\tcontentClassName=\"block-editor-media-replace-flow__options\"\n\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t<ToolbarGroup className=\"media-replace-flow\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tref={ editMediaButtonRef }\n\t\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\t\tonKeyDown={ openOnArrowDown }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ name }\n\t\t\t\t\t</Button>\n\t\t\t\t</ToolbarGroup>\n\t\t\t) }\n\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t<>\n\t\t\t\t\t<NavigableMenu className=\"block-editor-media-replace-flow__media-upload-menu\">\n\t\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\t\tvalue={ mediaId }\n\t\t\t\t\t\t\tonSelect={ ( media ) => selectMedia( media ) }\n\t\t\t\t\t\t\tallowedTypes={ allowedTypes }\n\t\t\t\t\t\t\trender={ ( { open } ) => (\n\t\t\t\t\t\t\t\t<MenuItem icon={ mediaIcon } onClick={ open }>\n\t\t\t\t\t\t\t\t\t{ __( 'Open Media Library' ) }\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t\t\t<FormFileUpload\n\t\t\t\t\t\t\t\tonChange={ ( event ) => {\n\t\t\t\t\t\t\t\t\tuploadFiles( event, onClose );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\taccept={ accept }\n\t\t\t\t\t\t\t\trender={ ( { openFileDialog } ) => {\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\t\t\ticon={ upload }\n\t\t\t\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t\t\t\topenFileDialog();\n\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{ __( 'Upload' ) }\n\t\t\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</MediaUploadCheck>\n\t\t\t\t\t</NavigableMenu>\n\t\t\t\t\t{ onSelectURL && (\n\t\t\t\t\t\t// eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n\t\t\t\t\t\t<form\n\t\t\t\t\t\t\tclassName=\"block-editor-media-flow__url-input\"\n\t\t\t\t\t\t\tonKeyDown={ ( event ) => {\n\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tonKeyPress={ ( event ) => {\n\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span className=\"block-editor-media-replace-flow__image-url-label\">\n\t\t\t\t\t\t\t\t{ __( 'Current media URL:' ) }\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<LinkControl\n\t\t\t\t\t\t\t\tvalue={ { url: mediaURLValue } }\n\t\t\t\t\t\t\t\tsettings={ [] }\n\t\t\t\t\t\t\t\tshowSuggestions={ false }\n\t\t\t\t\t\t\t\tonChange={ ( { url } ) => {\n\t\t\t\t\t\t\t\t\tsetMediaURLValue( url );\n\t\t\t\t\t\t\t\t\tselectURL( url );\n\t\t\t\t\t\t\t\t\teditMediaButtonRef.current.focus();\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</form>\n\t\t\t\t\t) }\n\t\t\t\t</>\n\t\t\t) }\n\t\t/>\n\t);\n};\n\nexport default compose( [\n\twithDispatch( ( dispatch ) => {\n\t\tconst { createNotice, removeNotice } = dispatch( 'core/notices' );\n\t\treturn {\n\t\t\tcreateNotice,\n\t\t\tremoveNotice,\n\t\t};\n\t} ),\n] )( MediaReplaceFlow );\n"]}